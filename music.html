<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç§„É≥„Éà„É≠„ÇØ„Ç§„Ç∫ - YouTubeÂØæÂøú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        
        * {
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        .gradient-cyan-teal {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 25%, #14b8a6 50%, #10b981 75%, #0891b2 100%);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .music-wave {
            animation: wave 1.2s linear infinite;
        }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }
        
        .correct-answer {
            animation: correctPulse 0.6s ease;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .search-result-item {
            transition: all 0.2s ease;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        #youtubePlayer {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }

        /* ÈÄöÁü•„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            max-width: 500px;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.95), rgba(5, 150, 105, 0.95));
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .notification.info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.95), rgba(37, 99, 235, 0.95));
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .notification.warning {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.95), rgba(245, 158, 11, 0.95));
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .notification.hiding {
            animation: slideOut 0.3s ease-in forwards;
        }
    </style>
</head>
<body class="gradient-cyan-teal min-h-screen">
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="text-center mb-8">
            <h1 class="text-5xl md:text-6xl font-black text-white mb-2 drop-shadow-lg">
                üéµ „Ç§„É≥„Éà„É≠„ÇØ„Ç§„Ç∫
            </h1>
            <p class="text-xl text-white/90 drop-shadow">Èü≥Ê•Ω„ÅÆÊúÄÂàù„ÅÆÊï∞Áßí„ÅßÊõ≤Âêç„ÇíÂΩì„Å¶„Çà„ÅÜ!</p>
        </header>

        <!-- „É°„Ç§„É≥ÁîªÈù¢Âàá„ÇäÊõø„Åà„Ç®„É™„Ç¢ -->
        <div id="app">
            <!-- „É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜÁîªÈù¢ -->
            <div id="userManagement" class="space-y-6">
                <div class="glass-effect rounded-3xl p-8 shadow-2xl">
                    <h2 class="text-3xl font-bold text-white mb-6 flex items-center gap-3">
                        <span class="text-4xl">üë•</span>
                        „Éó„É¨„Ç§„É§„ÉºÁÆ°ÁêÜ
                    </h2>
                    
                    <!-- „Éó„É¨„Ç§„É§„ÉºËøΩÂä†„Éï„Ç©„Éº„É† -->
                    <div class="mb-6 flex gap-3">
                        <input 
                            type="text" 
                            id="newPlayerName" 
                            placeholder="„Éó„É¨„Ç§„É§„ÉºÂêç„ÇíÂÖ•Âäõ"
                            maxlength="20"
                            class="flex-1 px-4 py-3 rounded-xl bg-white/20 text-white placeholder-white/60 border border-white/30 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent"
                        />
                        <button 
                            onclick="addPlayer()"
                            class="px-6 py-3 bg-white text-cyan-600 rounded-xl font-bold hover:bg-white/90 transition-all transform hover:scale-105 active:scale-95"
                        >
                            ËøΩÂä†
                        </button>
                    </div>
                    
                    <!-- „Éó„É¨„Ç§„É§„Éº„É™„Çπ„Éà -->
                    <div id="playerList" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                        <!-- „Éó„É¨„Ç§„É§„Éº„Ç´„Éº„Éâ„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                    </div>
                    
                    <div class="text-sm text-white/70 text-center mb-4">
                        ‚Äª ÊúÄÂ§ß4‰∫∫„Åæ„ÅßÁôªÈå≤ÂèØËÉΩ
                    </div>
                </div>

                <!-- YouTubeÊ§úÁ¥¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="glass-effect rounded-3xl p-8 shadow-2xl">
                    <h2 class="text-3xl font-bold text-white mb-6 flex items-center gap-3">
                        <span class="text-4xl">üîç</span>
                        YouTubeÈü≥Ê•ΩÊ§úÁ¥¢
                    </h2>
                    
                    <!-- Ê§úÁ¥¢„Éï„Ç©„Éº„É† -->
                    <div class="mb-6">
                        <div class="flex gap-3">
                            <input 
                                type="text" 
                                id="youtubeSearch" 
                                placeholder="Êõ≤Âêç„ÇíÂÖ•Âäõ (‰æã: È¶ôÊ∞¥ Áëõ‰∫∫)"
                                class="flex-1 px-4 py-3 rounded-xl bg-white/20 text-white placeholder-white/60 border border-white/30 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent"
                                onkeypress="if(event.key==='Enter') searchYouTube()"
                            />
                            <button 
                                onclick="searchYouTube()"
                                class="px-6 py-3 bg-white text-cyan-600 rounded-xl font-bold hover:bg-white/90 transition-all transform hover:scale-105 active:scale-95"
                            >
                                Ê§úÁ¥¢
                            </button>
                        </div>
                        <div class="mt-2 text-sm text-white/70">
                            Ë§áÊï∞Êõ≤„ÇíËøΩÂä†„Åó„Å¶„ÄÅ„É©„É≥„ÉÄ„É†„Åß„ÇØ„Ç§„Ç∫„Å´Âá∫È°å„Åß„Åç„Åæ„Åô
                        </div>
                    </div>

                    <!-- Ê§úÁ¥¢‰∏≠Ë°®Á§∫ -->
                    <div id="searchLoading" class="hidden text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-white/30 border-t-white"></div>
                        <p class="text-white mt-4">Ê§úÁ¥¢‰∏≠...</p>
                    </div>

                    <!-- Ê§úÁ¥¢ÁµêÊûú -->
                    <div id="searchResults" class="space-y-3 mb-6 max-h-96 overflow-y-auto">
                        <!-- Ê§úÁ¥¢ÁµêÊûú„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                    </div>

                    <!-- ÈÅ∏Êäû„Åï„Çå„ÅüÊõ≤„É™„Çπ„Éà -->
                    <div class="mt-6">
                        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
                            <span>üìù</span>
                            ÈÅ∏Êäû„Åï„Çå„ÅüÊõ≤ (<span id="selectedCount">0</span>Êõ≤)
                        </h3>
                        <div id="selectedSongs" class="space-y-2 max-h-64 overflow-y-auto">
                            <div class="text-center text-white/60 py-4">„Åæ„Å†Êõ≤„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
                        </div>
                    </div>
                </div>

                <!-- „ÇØ„Ç§„Ç∫Ë®≠ÂÆö -->
                <div class="glass-effect rounded-3xl p-8 shadow-2xl">
                    <h2 class="text-3xl font-bold text-white mb-6 flex items-center gap-3">
                        <span class="text-4xl">üéÆ</span>
                        „ÇØ„Ç§„Ç∫Ë®≠ÂÆö
                    </h2>
                    
                    <!-- „Ç§„É≥„Éà„É≠ÂÜçÁîüÊôÇÈñì -->
                    <div class="mb-6">
                        <label class="block text-white font-semibold mb-3">
                            „Ç§„É≥„Éà„É≠ÂÜçÁîüÊôÇÈñì: <span id="introTimeDisplay" class="text-cyan-200">5</span>Áßí
                        </label>
                        <input 
                            type="range" 
                            id="introTime" 
                            min="3" 
                            max="15" 
                            value="5"
                            class="w-full h-2 bg-white/30 rounded-lg appearance-none cursor-pointer accent-white"
                        />
                        <div class="flex justify-between text-xs text-white/60 mt-1">
                            <span>3Áßí</span>
                            <span>15Áßí</span>
                        </div>
                    </div>
                    
                    <!-- „ÇØ„Ç§„Ç∫ÈñãÂßã„Éú„Çø„É≥ -->
                    <button 
                        onclick="startQuiz()"
                        class="w-full py-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white text-xl font-bold rounded-2xl hover:from-pink-600 hover:to-purple-700 transition-all transform hover:scale-105 active:scale-95 shadow-lg"
                    >
                        üéµ „ÇØ„Ç§„Ç∫„ÇíÈñãÂßã„Åô„Çã
                    </button>
                </div>

                <!-- „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ -->
                <div class="glass-effect rounded-3xl p-8 shadow-2xl">
                    <h2 class="text-3xl font-bold text-white mb-6 flex items-center gap-3">
                        <span class="text-4xl">üèÜ</span>
                        „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ
                    </h2>
                    <div id="scoreBoard" class="space-y-3">
                        <!-- „Çπ„Ç≥„Ç¢„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                    </div>
                    <button 
                        onclick="clearScores()"
                        class="mt-6 w-full py-3 bg-red-500/80 text-white font-bold rounded-xl hover:bg-red-600 transition-all"
                    >
                        „Çπ„Ç≥„Ç¢„Çí„ÇØ„É™„Ç¢
                    </button>
                </div>
            </div>

            <!-- „ÇØ„Ç§„Ç∫ÂÆüË°åÁîªÈù¢ -->
            <div id="quizGame" class="hidden">
                <div class="glass-effect rounded-3xl p-8 shadow-2xl">
                    <!-- „ÇØ„Ç§„Ç∫„Éò„ÉÉ„ÉÄ„Éº -->
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold text-white flex items-center gap-3">
                            <span class="text-4xl">üéµ</span>
                            „ÇØ„Ç§„Ç∫‰∏≠
                        </h2>
                        <button 
                            onclick="endQuiz()"
                            class="px-6 py-2 bg-red-500/80 text-white font-bold rounded-xl hover:bg-red-600 transition-all"
                        >
                            ÁµÇ‰∫Ü
                        </button>
                    </div>
                    
                    <!-- ÈÄ≤ÊçóË°®Á§∫ -->
                    <div class="mb-6">
                        <div class="flex justify-between text-white text-sm mb-2">
                            <span id="currentQuestion">ÂïèÈ°å 1/10</span>
                            <span id="timer" class="font-bold">--</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-3">
                            <div id="progressBar" class="bg-white h-3 rounded-full transition-all duration-300" style="width: 10%"></div>
                        </div>
                    </div>
                    
                    <!-- YouTube Player (ÈùûË°®Á§∫) -->
                    <div id="youtubePlayerContainer" class="mb-6 rounded-2xl overflow-hidden" style="display: none;">
                        <div id="youtubePlayer"></div>
                    </div>
                    
                    <!-- Èü≥Ê•ΩÊ≥¢ÂΩ¢„Éì„Ç∏„É•„Ç¢„É©„Ç§„Ç∂„Éº(„Ç§„É°„Éº„Ç∏) -->
                    <div class="flex justify-center items-end gap-1 h-32 mb-8 bg-white/10 rounded-2xl p-4">
                        <div class="w-2 bg-white/60 rounded-full music-wave" style="height: 20%; animation-delay: 0s;"></div>
                        <div class="w-2 bg-white/70 rounded-full music-wave" style="height: 40%; animation-delay: 0.1s;"></div>
                        <div class="w-2 bg-white/80 rounded-full music-wave" style="height: 60%; animation-delay: 0.2s;"></div>
                        <div class="w-2 bg-white/90 rounded-full music-wave" style="height: 80%; animation-delay: 0.3s;"></div>
                        <div class="w-2 bg-white rounded-full music-wave" style="height: 100%; animation-delay: 0.4s;"></div>
                        <div class="w-2 bg-white/90 rounded-full music-wave" style="height: 80%; animation-delay: 0.5s;"></div>
                        <div class="w-2 bg-white/80 rounded-full music-wave" style="height: 60%; animation-delay: 0.6s;"></div>
                        <div class="w-2 bg-white/70 rounded-full music-wave" style="height: 40%; animation-delay: 0.7s;"></div>
                        <div class="w-2 bg-white/60 rounded-full music-wave" style="height: 20%; animation-delay: 0.8s;"></div>
                    </div>
                    
                    <!-- ÁèæÂú®„ÅÆÊõ≤ÊÉÖÂ†± -->
                    <div class="text-center mb-8">
                        <p class="text-white/70 text-sm mb-2">„Åì„ÅÆÊõ≤„ÅÆ„Çø„Ç§„Éà„É´„ÅØ?</p>
                        <p id="currentSongTitle" class="text-2xl font-bold text-white hidden">Êõ≤Âêç„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</p>
                        <img id="currentThumbnail" class="hidden mx-auto mt-4 rounded-xl shadow-lg max-w-xs" alt="„Çµ„É†„Éç„Ç§„É´">
                    </div>
                    
                    <!-- „Éó„É¨„Ç§„É§„Éº„Éú„Çø„É≥ -->
                    <div class="grid grid-cols-2 gap-4 mb-6" id="playerButtons">
                        <!-- „Éó„É¨„Ç§„É§„Éº„Éú„Çø„É≥„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                    </div>
                    
                    <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥ -->
                    <div class="flex gap-4">
                        <button 
                            onclick="playIntro()"
                            id="playButton"
                            class="flex-1 py-4 bg-white text-cyan-600 font-bold rounded-2xl hover:bg-white/90 transition-all transform hover:scale-105 active:scale-95 shadow-lg"
                        >
                            ‚ñ∂Ô∏è „Ç§„É≥„Éà„É≠„ÇíÂÜçÁîü
                        </button>
                        <button 
                            onclick="showAnswer()"
                            id="showAnswerButton"
                            class="flex-1 py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold rounded-2xl hover:from-yellow-500 hover:to-orange-600 transition-all transform hover:scale-105 active:scale-95 shadow-lg"
                        >
                            üí° Á≠î„Åà„ÇíË°®Á§∫
                        </button>
                        <button 
                            onclick="nextQuestion()"
                            id="nextButton"
                            class="flex-1 py-4 bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold rounded-2xl hover:from-green-500 hover:to-blue-600 transition-all transform hover:scale-105 active:scale-95 shadow-lg"
                        >
                            ‚û°Ô∏è Ê¨°„ÅÆÂïèÈ°å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>


    <script>
        // YouTube API Key
        const YOUTUBE_API_KEY = 'AIzaSyAubPfKVpT9cJNEjH--8LqzPuy39Usy83Q';
        
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let players = JSON.parse(localStorage.getItem('quizPlayers')) || [];
        let scores = JSON.parse(localStorage.getItem('quizScores')) || {};
        let selectedSongs = JSON.parse(localStorage.getItem('selectedSongs')) || [];
        let currentQuestionIndex = 0;
        let introTime = 5;
        let questionAnswered = false;
        let youtubePlayer = null;
        let playerReady = false;

        // YouTube IFrame Player APIÊ∫ñÂÇôÂÆå‰∫Ü
        function onYouTubeIframeAPIReady() {
            console.log('YouTube IFrame API Ready');
        }

        // YouTube Player„ÅÆÂàùÊúüÂåñ
        function initYouTubePlayer(videoId) {
            return new Promise((resolve) => {
                if (youtubePlayer) {
                    youtubePlayer.destroy();
                }
                
                youtubePlayer = new YT.Player('youtubePlayer', {
                    height: '0',
                    width: '0',
                    videoId: videoId,
                    playerVars: {
                        'autoplay': 0,
                        'controls': 0,
                        'disablekb': 1,
                        'fs': 0,
                        'modestbranding': 1
                    },
                    events: {
                        'onReady': () => {
                            playerReady = true;
                            showNotification('üéµ „Éó„É¨„Ç§„É§„Éº„ÅÆÊ∫ñÂÇô„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
                            resolve();
                        }
                    }
                });
            });
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updatePlayerList();
            updateScoreBoard();
            updateSelectedSongs();
            
            // „Ç§„É≥„Éà„É≠ÊôÇÈñì„Çπ„É©„Ç§„ÉÄ„Éº
            document.getElementById('introTime').addEventListener('input', function(e) {
                introTime = parseInt(e.target.value);
                document.getElementById('introTimeDisplay').textContent = introTime;
            });
        });

        // YouTubeÊ§úÁ¥¢
        async function searchYouTube() {
            const query = document.getElementById('youtubeSearch').value.trim();
            
            if (!query) {
                alert('Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const searchResults = document.getElementById('searchResults');
            const searchLoading = document.getElementById('searchLoading');
            
            searchLoading.classList.remove('hidden');
            searchResults.innerHTML = '';
            
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=20&q=${encodeURIComponent(query)}&type=video&videoCategoryId=10&key=${YOUTUBE_API_KEY}`
                );
                
                const data = await response.json();
                searchLoading.classList.add('hidden');
                
                if (data.items && data.items.length > 0) {
                    // ‰∏ÄÊã¨ËøΩÂä†„Éú„Çø„É≥„ÇíË°®Á§∫
                    searchResults.innerHTML = `
                        <div class="sticky top-0 bg-gradient-to-r from-green-500 to-blue-500 rounded-xl p-4 mb-4 flex justify-between items-center z-10">
                            <span class="text-white font-bold">
                                <span id="selectedSearchCount">0</span>Êõ≤ÈÅ∏Êäû‰∏≠
                            </span>
                            <div class="flex gap-2">
                                <button 
                                    onclick="selectAllSearchResults()"
                                    class="px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all font-semibold"
                                >
                                    ÂÖ®„Å¶ÈÅ∏Êäû
                                </button>
                                <button 
                                    onclick="addSelectedSongsToPlaylist()"
                                    class="px-6 py-2 bg-white text-cyan-600 rounded-lg hover:bg-white/90 transition-all font-bold"
                                >
                                    ÈÅ∏Êäû„Åó„ÅüÊõ≤„ÇíËøΩÂä†
                                </button>
                            </div>
                        </div>
                    ` + data.items.map((item, index) => `
                        <div class="search-result-item glass-effect rounded-xl p-4">
                            <div class="flex gap-4 items-center">
                                <input 
                                    type="checkbox" 
                                    id="song_${index}" 
                                    data-video-id="${item.id.videoId}"
                                    data-title="${escapeHtml(item.snippet.title)}"
                                    data-thumbnail="${item.snippet.thumbnails.default.url}"
                                    onchange="updateSelectedSearchCount()"
                                    class="w-6 h-6 rounded accent-cyan-500 cursor-pointer"
                                />
                                <img src="${item.snippet.thumbnails.default.url}" class="w-24 h-18 rounded-lg object-cover" alt="thumbnail">
                                <div class="flex-1">
                                    <h4 class="text-white font-semibold mb-1">${item.snippet.title}</h4>
                                    <p class="text-white/60 text-sm">${item.snippet.channelTitle}</p>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    searchResults.innerHTML = '<div class="text-center text-white/60 py-8">Ê§úÁ¥¢ÁµêÊûú„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</div>';
                }
            } catch (error) {
                searchLoading.classList.add('hidden');
                console.error('YouTube API Error:', error);
                alert('Ê§úÁ¥¢‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇAPI„Ç≠„Éº„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }

        // ÈÅ∏Êäû‰∏≠„ÅÆÊõ≤Êï∞„ÇíÊõ¥Êñ∞
        function updateSelectedSearchCount() {
            const checkboxes = document.querySelectorAll('.search-result-item input[type="checkbox"]');
            const selectedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            const countElement = document.getElementById('selectedSearchCount');
            if (countElement) {
                countElement.textContent = selectedCount;
            }
        }

        // ÂÖ®„Å¶ÈÅ∏Êäû
        function selectAllSearchResults() {
            const checkboxes = document.querySelectorAll('.search-result-item input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(cb => {
                cb.checked = !allChecked;
            });
            updateSelectedSearchCount();
        }

        // ÈÅ∏Êäû„Åó„ÅüÊõ≤„Çí„Åæ„Å®„ÇÅ„Å¶ËøΩÂä†
        function addSelectedSongsToPlaylist() {
            const checkboxes = document.querySelectorAll('.search-result-item input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert('Êõ≤„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            let addedCount = 0;
            let skippedCount = 0;
            
            checkboxes.forEach(checkbox => {
                const videoId = checkbox.dataset.videoId;
                const title = checkbox.dataset.title;
                const thumbnail = checkbox.dataset.thumbnail;
                
                // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
                if (!selectedSongs.some(song => song.videoId === videoId)) {
                    selectedSongs.push({
                        videoId: videoId,
                        title: title,
                        thumbnail: thumbnail
                    });
                    addedCount++;
                } else {
                    skippedCount++;
                }
            });
            
            localStorage.setItem('selectedSongs', JSON.stringify(selectedSongs));
            updateSelectedSongs();
            
            // ÁµêÊûú„Çí„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅßÈÄöÁü•
            showNotification(`‚úÖ ${addedCount}Êõ≤„ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ${skippedCount > 0 ? `\n(${skippedCount}Êõ≤„ÅØÊó¢„Å´ËøΩÂä†Ê∏à„Åø„ÅÆ„Åü„ÇÅ„Çπ„Ç≠„ÉÉ„Éó)` : ''}`, 'success');
            
            // Ê§úÁ¥¢ÁµêÊûú„Çí„ÇØ„É™„Ç¢
            document.getElementById('youtubeSearch').value = '';
            document.getElementById('searchResults').innerHTML = '';
        }

        // „Éó„É¨„Ç§„É™„Çπ„Éà„Å´Êõ≤„ÇíËøΩÂä†
        function addSongToPlaylist(videoId, title, thumbnail) {
            if (selectedSongs.some(song => song.videoId === videoId)) {
                alert('„Åì„ÅÆÊõ≤„ÅØÊó¢„Å´ËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
                return;
            }
            
            selectedSongs.push({
                videoId: videoId,
                title: title,
                thumbnail: thumbnail
            });
            
            localStorage.setItem('selectedSongs', JSON.stringify(selectedSongs));
            updateSelectedSongs();
            
            // Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Ç¢
            document.getElementById('youtubeSearch').value = '';
            document.getElementById('searchResults').innerHTML = '';
        }

        // ÈÅ∏Êäû„Åï„Çå„ÅüÊõ≤„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
        function updateSelectedSongs() {
            const container = document.getElementById('selectedSongs');
            const countElement = document.getElementById('selectedCount');
            
            countElement.textContent = selectedSongs.length;
            
            if (selectedSongs.length === 0) {
                container.innerHTML = '<div class="text-center text-white/60 py-4">„Åæ„Å†Êõ≤„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>';
                return;
            }
            
            container.innerHTML = selectedSongs.map((song, index) => `
                <div class="glass-effect rounded-xl p-3 flex items-center gap-3">
                    <img src="${song.thumbnail}" class="w-16 h-12 rounded-lg object-cover" alt="thumbnail">
                    <div class="flex-1 min-w-0">
                        <p class="text-white font-semibold truncate">${song.title}</p>
                    </div>
                    <button 
                        onclick="removeSong(${index})"
                        class="text-red-300 hover:text-red-100 font-bold text-xl px-2"
                    >
                        ‚úï
                    </button>
                </div>
            `).join('');
        }

        // Êõ≤„ÇíÂâäÈô§
        function removeSong(index) {
            const songTitle = selectedSongs[index].title;
            selectedSongs.splice(index, 1);
            localStorage.setItem('selectedSongs', JSON.stringify(selectedSongs));
            updateSelectedSongs();
            showNotification(`üóëÔ∏è „Äå${songTitle}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`, 'info');
        }


        // „Éó„É¨„Ç§„É§„ÉºËøΩÂä†
        function addPlayer() {
            const input = document.getElementById('newPlayerName');
            const name = input.value.trim();
            
            if (!name) {
                alert('„Éó„É¨„Ç§„É§„ÉºÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (players.length >= 4) {
                alert('ÊúÄÂ§ß4‰∫∫„Åæ„Åß„Åß„Åô');
                return;
            }
            
            if (players.some(p => p.name === name)) {
                alert('Âêå„ÅòÂêçÂâç„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô');
                return;
            }
            
            const player = {
                id: Date.now(),
                name: name
            };
            
            players.push(player);
            if (!scores[player.id]) {
                scores[player.id] = 0;
            }
            
            savePlayers();
            saveScores();
            updatePlayerList();
            updateScoreBoard();
            input.value = '';
            showNotification(`üë§ ${name}„Åï„Çì„ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ`, 'success');
        }

        // „Éó„É¨„Ç§„É§„ÉºÂâäÈô§
        function removePlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (confirm('„Åì„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?')) {
                players = players.filter(p => p.id !== playerId);
                savePlayers();
                updatePlayerList();
                updateScoreBoard();
                showNotification(`üëã ${player.name}„Åï„Çì„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`, 'info');
            }
        }

        // „Éó„É¨„Ç§„É§„Éº„É™„Çπ„ÉàÊõ¥Êñ∞
        function updatePlayerList() {
            const container = document.getElementById('playerList');
            
            if (players.length === 0) {
                container.innerHTML = '<div class="col-span-2 text-center text-white/60 py-8">„Éó„É¨„Ç§„É§„Éº„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
                return;
            }
            
            container.innerHTML = players.map(player => `
                <div class="glass-effect rounded-2xl p-4 card-hover flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xl">
                            ${player.name.charAt(0).toUpperCase()}
                        </div>
                        <span class="text-white font-semibold text-lg">${player.name}</span>
                    </div>
                    <button 
                        onclick="removePlayer(${player.id})"
                        class="text-red-300 hover:text-red-100 font-bold text-xl"
                    >
                        ‚úï
                    </button>
                </div>
            `).join('');
        }

        // „Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÊõ¥Êñ∞
        function updateScoreBoard() {
            const container = document.getElementById('scoreBoard');
            
            if (players.length === 0) {
                container.innerHTML = '<div class="text-center text-white/60 py-4">„Éó„É¨„Ç§„É§„Éº„Åå„ÅÑ„Åæ„Åõ„Çì</div>';
                return;
            }
            
            const sortedPlayers = [...players].sort((a, b) => (scores[b.id] || 0) - (scores[a.id] || 0));
            
            container.innerHTML = sortedPlayers.map((player, index) => {
                const score = scores[player.id] || 0;
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                const medal = index < 3 ? medals[index] : 'üèÖ';
                
                return `
                    <div class="flex items-center justify-between bg-white/10 rounded-xl p-4">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">${medal}</span>
                            <span class="text-white font-semibold">${player.name}</span>
                        </div>
                        <span class="text-2xl font-bold text-white">${score}pt</span>
                    </div>
                `;
            }).join('');
        }

        // „Çπ„Ç≥„Ç¢„ÇØ„É™„Ç¢
        function clearScores() {
            if (confirm('ÂÖ®„Å¶„ÅÆ„Çπ„Ç≥„Ç¢„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„Åã?')) {
                scores = {};
                players.forEach(player => {
                    scores[player.id] = 0;
                });
                saveScores();
                updateScoreBoard();
                showNotification('üîÑ „Çπ„Ç≥„Ç¢„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü', 'success');
            }
        }

        // „ÇØ„Ç§„Ç∫ÈñãÂßã
        async function startQuiz() {
            if (players.length === 0) {
                alert('„Éó„É¨„Ç§„É§„Éº„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (selectedSongs.length === 0) {
                alert('YouTube„ÅßÊõ≤„ÇíÊ§úÁ¥¢„Åó„Å¶ËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            currentQuestionIndex = 0;
            shuffleArray(selectedSongs);
            
            document.getElementById('userManagement').classList.add('hidden');
            document.getElementById('quizGame').classList.remove('hidden');
            
            showNotification(`üéÆ „ÇØ„Ç§„Ç∫„ÇíÈñãÂßã„Åó„Åæ„ÅôÔºÅÂÖ®${selectedSongs.length}Âïè`, 'success');
            
            await loadQuestion();
        }

        // ÂïèÈ°åË™≠„ÅøËæº„Åø
        async function loadQuestion() {
            questionAnswered = false;
            document.getElementById('currentSongTitle').classList.add('hidden');
            document.getElementById('currentThumbnail').classList.add('hidden');
            
            const progress = ((currentQuestionIndex + 1) / selectedSongs.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = 
                `ÂïèÈ°å ${currentQuestionIndex + 1}/${selectedSongs.length}`;
            
            // „Éó„É¨„Ç§„É§„Éº„Éú„Çø„É≥ÁîüÊàê
            const buttonContainer = document.getElementById('playerButtons');
            buttonContainer.innerHTML = players.map(player => `
                <button 
                    onclick="playerAnswer(${player.id})"
                    class="col-span-1 py-6 bg-gradient-to-br from-purple-500 to-pink-500 text-white font-bold rounded-2xl hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105 active:scale-95 shadow-lg text-lg"
                >
                    ${player.name}
                </button>
            `).join('');
            
            // YouTube PlayerÂàùÊúüÂåñ
            const currentSong = selectedSongs[currentQuestionIndex];
            await initYouTubePlayer(currentSong.videoId);
        }


        // „Ç§„É≥„Éà„É≠ÂÜçÁîü
        function playIntro() {
            if (!playerReady || !youtubePlayer) {
                alert('„Éó„É¨„Ç§„É§„Éº„ÅÆÊ∫ñÂÇô‰∏≠„Åß„Åô„ÄÇÂ∞ë„ÄÖ„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            youtubePlayer.seekTo(0);
            youtubePlayer.playVideo();
            
            // „Çø„Ç§„Éû„ÉºË°®Á§∫
            let timeLeft = introTime;
            const timerDisplay = document.getElementById('timer');
            timerDisplay.textContent = timeLeft + 'Áßí';
            
            const interval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft + 'Áßí';
                
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    youtubePlayer.pauseVideo();
                    timerDisplay.textContent = 'ÁµÇ‰∫Ü';
                }
            }, 1000);
            
            // ÊåáÂÆöÊôÇÈñìÂæå„Å´ÂÅúÊ≠¢
            setTimeout(() => {
                youtubePlayer.pauseVideo();
                clearInterval(interval);
            }, introTime * 1000);
        }

        // „Éó„É¨„Ç§„É§„ÉºÂõûÁ≠î
        function playerAnswer(playerId) {
            if (questionAnswered) {
                showNotification('‚ö†Ô∏è „Åì„ÅÆÂïèÈ°å„ÅØÊó¢„Å´ÂõûÁ≠î„Åï„Çå„Å¶„ÅÑ„Åæ„Åô', 'warning');
                return;
            }
            
            const player = players.find(p => p.id === playerId);
            const correctAnswer = confirm(`${player.name}„Åï„Çì„ÅÆÂõûÁ≠î„ÅØÊ≠£Ëß£„Åß„Åô„Åã?`);
            
            if (correctAnswer) {
                scores[playerId] = (scores[playerId] || 0) + 10;
                saveScores();
                updateScoreBoard();
                questionAnswered = true;
                
                // Ê≠£Ëß£„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                event.target.classList.add('correct-answer');
                setTimeout(() => {
                    event.target.classList.remove('correct-answer');
                }, 600);
                
                showNotification(`üéâ Ê≠£Ëß£ÔºÅ${player.name}„Åï„Çì„Å´10„Éù„Ç§„É≥„ÉàÔºÅ`, 'success');
            } else {
                showNotification(`‚ùå ‰∏çÊ≠£Ëß£...`, 'error');
            }
        }

        // Á≠î„Åà„ÇíË°®Á§∫
        function showAnswer() {
            const currentSong = selectedSongs[currentQuestionIndex];
            
            document.getElementById('currentSongTitle').textContent = currentSong.title;
            document.getElementById('currentSongTitle').classList.remove('hidden');
            
            const thumbnailImg = document.getElementById('currentThumbnail');
            thumbnailImg.src = currentSong.thumbnail.replace('default.jpg', 'hqdefault.jpg');
            thumbnailImg.classList.remove('hidden');
            
            showNotification(`üí° Ê≠£Ëß£: ${currentSong.title}`, 'info');
            
            // ÂÖ®Êõ≤ÂÜçÁîü
            if (youtubePlayer && playerReady) {
                youtubePlayer.seekTo(0);
                youtubePlayer.playVideo();
            }
        }

        // Ê¨°„ÅÆÂïèÈ°å
        async function nextQuestion() {
            if (youtubePlayer) {
                youtubePlayer.pauseVideo();
            }
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= selectedSongs.length) {
                endQuiz();
            } else {
                await loadQuestion();
            }
        }

        // „ÇØ„Ç§„Ç∫ÁµÇ‰∫Ü
        function endQuiz() {
            if (youtubePlayer) {
                youtubePlayer.pauseVideo();
                youtubePlayer.destroy();
                youtubePlayer = null;
            }
            
            document.getElementById('quizGame').classList.add('hidden');
            document.getElementById('userManagement').classList.remove('hidden');
            
            // ÊúÄÁµÇÁµêÊûúË°®Á§∫
            const sortedPlayers = [...players].sort((a, b) => (scores[b.id] || 0) - (scores[a.id] || 0));
            const winner = sortedPlayers[0];
            
            if (winner && scores[winner.id] > 0) {
                showNotification(`üèÜ ÂÑ™Âãù: ${winner.name}„Åï„Çì (${scores[winner.id]}„Éù„Ç§„É≥„Éà)`, 'success');
                setTimeout(() => {
                    alert(`üèÜ ÂÑ™Âãù: ${winner.name}„Åï„Çì (${scores[winner.id]}„Éù„Ç§„É≥„Éà)`);
                }, 500);
            } else {
                showNotification('üéµ „ÇØ„Ç§„Ç∫„ÅåÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü', 'info');
            }
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function savePlayers() {
            localStorage.setItem('quizPlayers', JSON.stringify(players));
        }

        function saveScores() {
            localStorage.setItem('quizScores', JSON.stringify(scores));
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // ÈÄöÁü•„ÇíË°®Á§∫
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            // „Ç¢„Ç§„Ç≥„É≥„ÇíÈÅ∏Êäû
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '‚úÖ';
                    break;
                case 'info':
                    icon = '‚ÑπÔ∏è';
                    break;
                case 'warning':
                    icon = '‚ö†Ô∏è';
                    break;
                case 'error':
                    icon = '‚ùå';
                    break;
            }
            
            notification.innerHTML = `
                <span style="font-size: 24px;">${icon}</span>
                <div style="flex: 1; color: white; font-weight: 600; line-height: 1.5;">${message.replace(/\n/g, '<br>')}</div>
                <button onclick="this.parentElement.remove()" style="color: white; font-size: 20px; opacity: 0.8; hover:opacity: 1;">&times;</button>
            `;
            
            document.body.appendChild(notification);
            
            // 3ÁßíÂæå„Å´Ëá™Âãï„ÅßÊ∂à„Åô
            setTimeout(() => {
                notification.classList.add('hiding');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
