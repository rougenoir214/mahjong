<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>„Ç§„É≥„Éà„É≠„ÇØ„Ç§„Ç∫ - „É¢„Éê„Ç§„É´Áâà</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        
        * {
            font-family: 'Noto Sans JP', sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body {
            overscroll-behavior: none;
        }
        
        .gradient-cyan-teal {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 25%, #14b8a6 50%, #10b981 75%, #0891b2 100%);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        
        .btn-touch {
            transition: all 0.15s ease;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .btn-touch:active {
            transform: scale(0.95);
            filter: brightness(0.9);
        }
        
        .music-wave {
            animation: wave 1.2s linear infinite;
        }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }
        
        .correct-answer {
            animation: correctPulse 0.6s ease;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* YouTube Player Container */
        #player {
            position: fixed;
            top: -9999px;
            left: -9999px;
        }
        
        /* „Çπ„Éû„ÉõÁî®„ÅÆÂ§ß„Åç„Å™„Éú„Çø„É≥ */
        .mobile-btn {
            min-height: 60px;
            font-size: 1.125rem;
        }
        
        /* „Éó„É¨„Ç§„É§„Éº„Ç´„Éº„Éâ„ÅÆÊúÄÈÅ©Âåñ */
        .player-card {
            min-height: 80px;
        }
        
        /* „Çπ„ÉØ„Ç§„Éó„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
        .swipe-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
    </style>
</head>
<body class="gradient-cyan-teal min-h-screen">
    <!-- YouTube Player (ÈùûË°®Á§∫) -->
    <div id="player"></div>
    
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä -->
    <div class="container mx-auto px-3 py-4 max-w-2xl pb-20">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="text-center mb-6">
            <h1 class="text-4xl font-black text-white mb-2 drop-shadow-lg">
                üéµ „Ç§„É≥„Éà„É≠„ÇØ„Ç§„Ç∫
            </h1>
            <p class="text-base text-white/90 drop-shadow">„Çπ„Éû„ÉõÊúÄÈÅ©ÂåñÁâà</p>
        </header>

        <!-- „É°„Ç§„É≥ÁîªÈù¢Âàá„ÇäÊõø„Åà„Ç®„É™„Ç¢ -->
        <div id="app">
            <!-- „É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜÁîªÈù¢ -->
            <div id="userManagement" class="space-y-4">
                <!-- „Éó„É¨„Ç§„É§„ÉºÁÆ°ÁêÜ -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">üë•</span>
                        „Éó„É¨„Ç§„É§„Éº
                    </h2>
                    
                    <!-- „Éó„É¨„Ç§„É§„ÉºËøΩÂä†„Éï„Ç©„Éº„É† -->
                    <div class="mb-4 flex gap-2">
                        <input 
                            type="text" 
                            id="newPlayerName" 
                            placeholder="„Éó„É¨„Ç§„É§„ÉºÂêç"
                            maxlength="15"
                            class="flex-1 px-4 py-4 text-lg rounded-2xl bg-white/20 text-white placeholder-white/60 border border-white/30 focus:outline-none focus:ring-2 focus:ring-white/50"
                        />
                        <button 
                            onclick="addPlayer()"
                            class="px-6 py-4 bg-white text-cyan-600 rounded-2xl font-bold btn-touch text-lg"
                        >
                            ËøΩÂä†
                        </button>
                    </div>
                    
                    <!-- „Éó„É¨„Ç§„É§„Éº„É™„Çπ„Éà -->
                    <div id="playerList" class="space-y-3 mb-4">
                        <!-- „Éó„É¨„Ç§„É§„Éº„Ç´„Éº„Éâ„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                    </div>
                    
                    <div class="text-xs text-white/70 text-center">
                        ‚Äª ÊúÄÂ§ß4‰∫∫„Åæ„ÅßÁôªÈå≤ÂèØËÉΩ
                    </div>
                </div>

                <!-- YouTubeÊ§úÁ¥¢ -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">üé¨</span>
                        Êõ≤„ÇíÊ§úÁ¥¢
                    </h2>
                    
                    <!-- Ê§úÁ¥¢„Éï„Ç©„Éº„É† -->
                    <div class="mb-4 flex gap-2">
                        <input 
                            type="text" 
                            id="searchQuery" 
                            placeholder="Êõ≤Âêç„ÅßÊ§úÁ¥¢"
                            class="flex-1 px-4 py-3 rounded-xl bg-white/20 text-white placeholder-white/60 border border-white/30 focus:outline-none focus:ring-2 focus:ring-white/50"
                        />
                        <button 
                            onclick="searchYouTube()"
                            class="px-6 py-3 bg-white text-cyan-600 rounded-xl font-bold btn-touch"
                        >
                            Ê§úÁ¥¢
                        </button>
                    </div>
                    
                    <!-- Ê§úÁ¥¢ÁµêÊûú -->
                    <div id="searchResults" class="space-y-2 max-h-60 overflow-y-auto">
                        <!-- Ê§úÁ¥¢ÁµêÊûú„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                    </div>
                    
                    <!-- ÈÅ∏ÊäûÊ∏à„ÅøÊõ≤„É™„Çπ„Éà -->
                    <div class="mt-4">
                        <h3 class="text-white font-semibold mb-2 text-sm">ÈÅ∏ÊäûÊ∏à„Åø: <span id="selectedCount">0</span>Êõ≤</h3>
                        <div id="selectedSongs" class="space-y-2 max-h-40 overflow-y-auto">
                            <!-- ÈÅ∏ÊäûÊ∏à„ÅøÊõ≤„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                        </div>
                    </div>
                </div>

                <!-- „ÇØ„Ç§„Ç∫Ë®≠ÂÆö -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">‚öôÔ∏è</span>
                        Ë®≠ÂÆö
                    </h2>
                    
                    <!-- „Ç§„É≥„Éà„É≠ÂÜçÁîüÊôÇÈñì -->
                    <div class="mb-4">
                        <label class="block text-white font-semibold mb-2">
                            „Ç§„É≥„Éà„É≠ÊôÇÈñì: <span id="introTimeDisplay" class="text-cyan-200">5</span>Áßí
                        </label>
                        <input 
                            type="range" 
                            id="introTime" 
                            min="3" 
                            max="15" 
                            value="5"
                            class="w-full h-3 bg-white/30 rounded-lg appearance-none cursor-pointer accent-white"
                        />
                        <div class="flex justify-between text-xs text-white/60 mt-1">
                            <span>3Áßí</span>
                            <span>15Áßí</span>
                        </div>
                    </div>
                    
                    <!-- „ÇØ„Ç§„Ç∫ÈñãÂßã„Éú„Çø„É≥ -->
                    <button 
                        onclick="startQuiz()"
                        class="w-full py-5 bg-gradient-to-r from-pink-500 to-purple-600 text-white text-xl font-bold rounded-2xl btn-touch shadow-lg mobile-btn"
                    >
                        üéµ „ÇØ„Ç§„Ç∫„ÇíÈñãÂßã
                    </button>
                </div>

                <!-- „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">üèÜ</span>
                        „Çπ„Ç≥„Ç¢
                    </h2>
                    <div id="scoreBoard" class="space-y-2">
                        <!-- „Çπ„Ç≥„Ç¢„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                    </div>
                    <button 
                        onclick="clearScores()"
                        class="mt-4 w-full py-3 bg-red-500/80 text-white font-bold rounded-xl btn-touch"
                    >
                        „Çπ„Ç≥„Ç¢„Çí„ÇØ„É™„Ç¢
                    </button>
                </div>
            </div>

            <!-- „ÇØ„Ç§„Ç∫ÂÆüË°åÁîªÈù¢ -->
            <div id="quizGame" class="hidden space-y-4">
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <!-- „ÇØ„Ç§„Ç∫„Éò„ÉÉ„ÉÄ„Éº -->
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                            <span class="text-3xl">üéµ</span>
                            „ÇØ„Ç§„Ç∫‰∏≠
                        </h2>
                        <button 
                            onclick="endQuiz()"
                            class="px-4 py-2 bg-red-500/80 text-white font-bold rounded-xl btn-touch text-sm"
                        >
                            ÁµÇ‰∫Ü
                        </button>
                    </div>
                    
                    <!-- ÈÄ≤ÊçóË°®Á§∫ -->
                    <div class="mb-4">
                        <div class="flex justify-between text-white text-sm mb-2">
                            <span id="currentQuestion">ÂïèÈ°å 1/?</span>
                            <span id="timer" class="font-bold">--</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div id="progressBar" class="bg-white h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Èü≥Ê•ΩÊ≥¢ÂΩ¢„Éì„Ç∏„É•„Ç¢„É©„Ç§„Ç∂„Éº -->
                    <div class="flex justify-center items-end gap-1 h-24 mb-4 bg-white/10 rounded-2xl p-3">
                        <div class="w-2 bg-white/60 rounded-full music-wave" style="height: 20%; animation-delay: 0s;"></div>
                        <div class="w-2 bg-white/70 rounded-full music-wave" style="height: 40%; animation-delay: 0.1s;"></div>
                        <div class="w-2 bg-white/80 rounded-full music-wave" style="height: 60%; animation-delay: 0.2s;"></div>
                        <div class="w-2 bg-white/90 rounded-full music-wave" style="height: 80%; animation-delay: 0.3s;"></div>
                        <div class="w-2 bg-white rounded-full music-wave" style="height: 100%; animation-delay: 0.4s;"></div>
                        <div class="w-2 bg-white/90 rounded-full music-wave" style="height: 80%; animation-delay: 0.5s;"></div>
                        <div class="w-2 bg-white/80 rounded-full music-wave" style="height: 60%; animation-delay: 0.6s;"></div>
                        <div class="w-2 bg-white/70 rounded-full music-wave" style="height: 40%; animation-delay: 0.7s;"></div>
                        <div class="w-2 bg-white/60 rounded-full music-wave" style="height: 20%; animation-delay: 0.8s;"></div>
                    </div>
                    
                    <!-- ÁèæÂú®„ÅÆÊõ≤ÊÉÖÂ†± -->
                    <div class="text-center mb-4">
                        <p class="text-white/70 text-sm mb-2">„Åì„ÅÆÊõ≤„ÅÆ„Çø„Ç§„Éà„É´„ÅØ?</p>
                        <p id="currentSongTitle" class="text-lg font-bold text-white hidden">Êõ≤Âêç„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</p>
                    </div>
                    
                    <!-- „Éó„É¨„Ç§„É§„Éº„Éú„Çø„É≥ -->
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div id="playerButtons" class="col-span-2 grid grid-cols-2 gap-3">
                            <!-- „Éó„É¨„Ç§„É§„Éº„Éú„Çø„É≥„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
                        </div>
                    </div>
                    
                    <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥ -->
                    <div class="space-y-3">
                        <button 
                            onclick="playIntro()"
                            id="playButton"
                            class="w-full py-5 bg-white text-cyan-600 font-bold rounded-2xl btn-touch shadow-lg mobile-btn text-lg"
                        >
                            ‚ñ∂Ô∏è „Ç§„É≥„Éà„É≠„ÇíÂÜçÁîü
                        </button>
                        <div class="grid grid-cols-2 gap-3">
                            <button 
                                onclick="showAnswer()"
                                id="showAnswerButton"
                                class="py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold rounded-2xl btn-touch shadow-lg"
                            >
                                üí° Á≠î„Åà
                            </button>
                            <button 
                                onclick="nextQuestion()"
                                id="nextButton"
                                class="py-4 bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold rounded-2xl btn-touch shadow-lg"
                            >
                                ‚û°Ô∏è Ê¨°„Å∏
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let players = JSON.parse(localStorage.getItem('quizPlayers')) || [];
        let scores = JSON.parse(localStorage.getItem('quizScores')) || {};
        let selectedSongs = [];
        let currentQuestionIndex = 0;
        let introTime = 5;
        let questionAnswered = false;
        let ytPlayer = null;
        let playbackTimer = null;

        // YouTube IFrame APIÊ∫ñÂÇôÂÆå‰∫Ü
        function onYouTubeIframeAPIReady() {
            ytPlayer = new YT.Player('player', {
                height: '0',
                width: '0',
                playerVars: {
                    'playsinline': 1,
                    'controls': 0
                }
            });
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updatePlayerList();
            updateScoreBoard();
            
            // „Ç§„É≥„Éà„É≠ÊôÇÈñì„Çπ„É©„Ç§„ÉÄ„Éº
            document.getElementById('introTime').addEventListener('input', function(e) {
                introTime = parseInt(e.target.value);
                document.getElementById('introTimeDisplay').textContent = introTime;
            });
        });

        // „Éó„É¨„Ç§„É§„ÉºËøΩÂä†
        function addPlayer() {
            const input = document.getElementById('newPlayerName');
            const name = input.value.trim();
            
            if (!name) {
                alert('„Éó„É¨„Ç§„É§„ÉºÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (players.length >= 4) {
                alert('ÊúÄÂ§ß4‰∫∫„Åæ„Åß„Åß„Åô');
                return;
            }
            
            if (players.some(p => p.name === name)) {
                alert('Âêå„ÅòÂêçÂâç„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô');
                return;
            }
            
            const player = {
                id: Date.now(),
                name: name
            };
            
            players.push(player);
            if (!scores[player.id]) {
                scores[player.id] = 0;
            }
            
            savePlayers();
            saveScores();
            updatePlayerList();
            updateScoreBoard();
            input.value = '';
        }

        // „Éó„É¨„Ç§„É§„ÉºÂâäÈô§
        function removePlayer(playerId) {
            if (confirm('„Åì„ÅÆ„Éó„É¨„Ç§„É§„Éº„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?')) {
                players = players.filter(p => p.id !== playerId);
                savePlayers();
                updatePlayerList();
                updateScoreBoard();
            }
        }

        // „Éó„É¨„Ç§„É§„Éº„É™„Çπ„ÉàÊõ¥Êñ∞
        function updatePlayerList() {
            const container = document.getElementById('playerList');
            
            if (players.length === 0) {
                container.innerHTML = '<div class="text-center text-white/60 py-4 text-sm">„Éó„É¨„Ç§„É§„Éº„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
                return;
            }
            
            container.innerHTML = players.map(player => `
                <div class="glass-effect rounded-2xl p-4 flex items-center justify-between player-card">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            ${player.name.charAt(0).toUpperCase()}
                        </div>
                        <span class="text-white font-semibold">${player.name}</span>
                    </div>
                    <button 
                        onclick="removePlayer(${player.id})"
                        class="text-red-300 hover:text-red-100 font-bold text-2xl w-10 h-10 flex items-center justify-center"
                    >
                        ‚úï
                    </button>
                </div>
            `).join('');
        }

        // „Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÊõ¥Êñ∞
        function updateScoreBoard() {
            const container = document.getElementById('scoreBoard');
            
            if (players.length === 0) {
                container.innerHTML = '<div class="text-center text-white/60 py-3 text-sm">„Éó„É¨„Ç§„É§„Éº„Åå„ÅÑ„Åæ„Åõ„Çì</div>';
                return;
            }
            
            const sortedPlayers = [...players].sort((a, b) => (scores[b.id] || 0) - (scores[a.id] || 0));
            
            container.innerHTML = sortedPlayers.map((player, index) => {
                const score = scores[player.id] || 0;
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                const medal = index < 3 ? medals[index] : 'üèÖ';
                
                return `
                    <div class="flex items-center justify-between bg-white/10 rounded-xl p-3">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">${medal}</span>
                            <span class="text-white font-semibold">${player.name}</span>
                        </div>
                        <span class="text-xl font-bold text-white">${score}pt</span>
                    </div>
                `;
            }).join('');
        }

        // „Çπ„Ç≥„Ç¢„ÇØ„É™„Ç¢
        function clearScores() {
            if (confirm('ÂÖ®„Å¶„ÅÆ„Çπ„Ç≥„Ç¢„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„Åã?')) {
                scores = {};
                players.forEach(player => {
                    scores[player.id] = 0;
                });
                saveScores();
                updateScoreBoard();
            }
        }

        // YouTubeÊ§úÁ¥¢
        async function searchYouTube() {
            // API„Ç≠„Éº„ÇíÂüã„ÇÅËæº„ÅøÔºàÂÖ•Âäõ‰∏çË¶ÅÔºâ
            const apiKey = 'AIzaSyAubPfKVpT9cJNEjH--8LqzPuy39Usy83Q';
            const query = document.getElementById('searchQuery').value.trim();
            
            if (!query) {
                alert('Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const container = document.getElementById('searchResults');
            container.innerHTML = '<div class="text-white/70 text-center py-3 text-sm">Ê§úÁ¥¢‰∏≠...</div>';
            
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query + ' music')}&type=video&videoCategoryId=10&maxResults=10&key=${apiKey}`
                );
                
                if (!response.ok) {
                    throw new Error('Ê§úÁ¥¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
                
                const data = await response.json();
                
                if (!data.items || data.items.length === 0) {
                    container.innerHTML = '<div class="text-white/70 text-center py-3 text-sm">ÁµêÊûú„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</div>';
                    return;
                }
                
                container.innerHTML = data.items.map(item => `
                    <div class="bg-white/10 rounded-xl p-3 flex items-center gap-3">
                        <img src="${item.snippet.thumbnails.default.url}" class="w-16 h-12 rounded object-cover" />
                        <div class="flex-1 min-w-0">
                            <p class="text-white text-sm font-semibold truncate">${item.snippet.title}</p>
                            <p class="text-white/60 text-xs truncate">${item.snippet.channelTitle}</p>
                        </div>
                        <button 
                            onclick="addSong('${item.id.videoId}', '${item.snippet.title.replace(/'/g, "\\'")}', '${item.snippet.thumbnails.default.url}')"
                            class="px-3 py-2 bg-cyan-500 text-white rounded-lg btn-touch text-xs font-bold"
                        >
                            ËøΩÂä†
                        </button>
                    </div>
                `).join('');
                
            } catch (error) {
                container.innerHTML = '<div class="text-red-300 text-center py-3 text-sm">„Ç®„É©„Éº: ' + error.message + '</div>';
            }
        }

        // Êõ≤„ÇíËøΩÂä†
        function addSong(videoId, title, thumbnail) {
            if (selectedSongs.some(s => s.videoId === videoId)) {
                alert('„Åì„ÅÆÊõ≤„ÅØÊó¢„Å´ËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
                return;
            }
            
            selectedSongs.push({ videoId, title, thumbnail });
            updateSelectedSongs();
        }

        // ÈÅ∏ÊäûÊ∏à„ÅøÊõ≤„ÇíÂâäÈô§
        function removeSong(videoId) {
            selectedSongs = selectedSongs.filter(s => s.videoId !== videoId);
            updateSelectedSongs();
        }

        // ÈÅ∏ÊäûÊ∏à„ÅøÊõ≤„É™„Çπ„ÉàÊõ¥Êñ∞
        function updateSelectedSongs() {
            const container = document.getElementById('selectedSongs');
            const countDisplay = document.getElementById('selectedCount');
            
            countDisplay.textContent = selectedSongs.length;
            
            if (selectedSongs.length === 0) {
                container.innerHTML = '<div class="text-white/60 text-center py-2 text-xs">Êõ≤„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
                return;
            }
            
            container.innerHTML = selectedSongs.map(song => `
                <div class="bg-white/10 rounded-lg p-2 flex items-center gap-2">
                    <img src="${song.thumbnail}" class="w-12 h-9 rounded object-cover" />
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-xs truncate">${song.title}</p>
                    </div>
                    <button 
                        onclick="removeSong('${song.videoId}')"
                        class="text-red-300 font-bold text-lg w-8 h-8 flex items-center justify-center"
                    >
                        ‚úï
                    </button>
                </div>
            `).join('');
        }

        // „ÇØ„Ç§„Ç∫ÈñãÂßã
        function startQuiz() {
            if (players.length === 0) {
                alert('„Éó„É¨„Ç§„É§„Éº„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (selectedSongs.length === 0) {
                alert('Êõ≤„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!ytPlayer) {
                alert('YouTube Player„ÅÆÊ∫ñÂÇô„Åå„Åß„Åç„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÂ∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            currentQuestionIndex = 0;
            shuffleArray(selectedSongs);
            
            document.getElementById('userManagement').classList.add('hidden');
            document.getElementById('quizGame').classList.remove('hidden');
            
            loadQuestion();
        }

        // ÂïèÈ°åË™≠„ÅøËæº„Åø
        function loadQuestion() {
            questionAnswered = false;
            document.getElementById('currentSongTitle').classList.add('hidden');
            
            const progress = ((currentQuestionIndex + 1) / selectedSongs.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = 
                `ÂïèÈ°å ${currentQuestionIndex + 1}/${selectedSongs.length}`;
            
            // „Éó„É¨„Ç§„É§„Éº„Éú„Çø„É≥ÁîüÊàê
            const buttonContainer = document.getElementById('playerButtons');
            buttonContainer.innerHTML = players.map(player => `
                <button 
                    onclick="playerAnswer(${player.id})"
                    class="py-6 bg-gradient-to-br from-purple-500 to-pink-500 text-white font-bold rounded-2xl btn-touch shadow-lg mobile-btn"
                >
                    ${player.name}
                </button>
            `).join('');
            
            // YouTubeÂãïÁîª„Çí„É≠„Éº„Éâ
            const song = selectedSongs[currentQuestionIndex];
            ytPlayer.loadVideoById(song.videoId);
            ytPlayer.pauseVideo();
        }

        // „Ç§„É≥„Éà„É≠ÂÜçÁîü
        function playIntro() {
            if (!ytPlayer) {
                alert('YouTube Player„ÅåÊ∫ñÂÇô„Åß„Åç„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            
            ytPlayer.seekTo(0);
            ytPlayer.playVideo();
            
            // „Çø„Ç§„Éû„ÉºË°®Á§∫
            let timeLeft = introTime;
            const timerDisplay = document.getElementById('timer');
            timerDisplay.textContent = timeLeft + 'Áßí';
            
            if (playbackTimer) {
                clearInterval(playbackTimer);
            }
            
            playbackTimer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft + 'Áßí';
                
                if (timeLeft <= 0) {
                    clearInterval(playbackTimer);
                    ytPlayer.pauseVideo();
                    timerDisplay.textContent = 'ÁµÇ‰∫Ü';
                }
            }, 1000);
            
            // ÊåáÂÆöÊôÇÈñìÂæå„Å´ÂÅúÊ≠¢
            setTimeout(() => {
                ytPlayer.pauseVideo();
                if (playbackTimer) {
                    clearInterval(playbackTimer);
                }
            }, introTime * 1000);
        }

        // „Éó„É¨„Ç§„É§„ÉºÂõûÁ≠î
        function playerAnswer(playerId) {
            if (questionAnswered) {
                alert('„Åì„ÅÆÂïèÈ°å„ÅØÊó¢„Å´ÂõûÁ≠î„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
                return;
            }
            
            const player = players.find(p => p.id === playerId);
            const correctAnswer = confirm(`${player.name}„Åï„Çì„ÅÆÂõûÁ≠î„ÅØÊ≠£Ëß£„Åß„Åô„Åã?`);
            
            if (correctAnswer) {
                scores[playerId] = (scores[playerId] || 0) + 10;
                saveScores();
                updateScoreBoard();
                questionAnswered = true;
                
                alert(`üéâ Ê≠£Ëß£! ${player.name}„Åï„Çì„Å´10„Éù„Ç§„É≥„Éà!`);
            } else {
                alert(`‚ùå ‰∏çÊ≠£Ëß£...`);
            }
        }

        // Á≠î„Åà„ÇíË°®Á§∫
        function showAnswer() {
            const song = selectedSongs[currentQuestionIndex];
            
            document.getElementById('currentSongTitle').textContent = song.title;
            document.getElementById('currentSongTitle').classList.remove('hidden');
            
            // ÂÖ®Êõ≤ÂÜçÁîü
            if (ytPlayer) {
                ytPlayer.seekTo(0);
                ytPlayer.playVideo();
            }
        }

        // Ê¨°„ÅÆÂïèÈ°å
        function nextQuestion() {
            if (ytPlayer) {
                ytPlayer.pauseVideo();
            }
            
            if (playbackTimer) {
                clearInterval(playbackTimer);
            }
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= selectedSongs.length) {
                endQuiz();
            } else {
                loadQuestion();
            }
        }

        // „ÇØ„Ç§„Ç∫ÁµÇ‰∫Ü
        function endQuiz() {
            if (ytPlayer) {
                ytPlayer.pauseVideo();
            }
            
            if (playbackTimer) {
                clearInterval(playbackTimer);
            }
            
            document.getElementById('quizGame').classList.add('hidden');
            document.getElementById('userManagement').classList.remove('hidden');
            
            // ÊúÄÁµÇÁµêÊûúË°®Á§∫
            const sortedPlayers = [...players].sort((a, b) => (scores[b.id] || 0) - (scores[a.id] || 0));
            const winner = sortedPlayers[0];
            
            if (winner && scores[winner.id] > 0) {
                alert(`üèÜ ÂÑ™Âãù: ${winner.name}„Åï„Çì (${scores[winner.id]}„Éù„Ç§„É≥„Éà)`);
            }
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function savePlayers() {
            localStorage.setItem('quizPlayers', JSON.stringify(players));
        }

        function saveScores() {
            localStorage.setItem('quizScores', JSON.stringify(scores));
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>
