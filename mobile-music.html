<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Permissions Policy for YouTube Player -->
    <meta http-equiv="Permissions-Policy" content="autoplay=*, encrypted-media=*, accelerometer=*, gyroscope=*, picture-in-picture=*, clipboard-write=*, web-share=*">
    
    <title>ã‚¤ãƒ³ãƒˆãƒ­ã‚¯ã‚¤ã‚º - ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        
        * {
            font-family: 'Noto Sans JP', sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            box-sizing: border-box;
        }
        
        /* ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å°‚ç”¨ï¼ˆè¦–è¦šçš„ã«ã¯éè¡¨ç¤ºã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã«ã¯èª­ã¿ä¸Šã’ã‚‰ã‚Œã‚‹ï¼‰ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        /* iPhone Safariå¯¾å¿œ */
        input, button, select, textarea {
            font-size: 16px !important; /* 16pxæœªæº€ã ã¨iOSãŒè‡ªå‹•ã‚ºãƒ¼ãƒ ã™ã‚‹ */
            -webkit-appearance: none;
        }
        
        input[type="text"] {
            width: 100%;
            max-width: 100%;
        }
        
        input[type="range"] {
            width: 100%;
        }
        
        /* flexå†…ã®å…¥åŠ›æ¬„ã®å¹…åˆ¶å¾¡ */
        .flex input {
            min-width: 0;
            flex-shrink: 1;
        }
        
        body {
            overscroll-behavior: none;
            overflow-x: hidden;
            max-width: 100vw;
        }
        
        html {
            overflow-x: hidden;
        }
        
        .gradient-cyan-teal {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 25%, #14b8a6 50%, #10b981 75%, #0891b2 100%);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        
        .btn-touch {
            transition: all 0.15s ease;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .btn-touch:active:not(:disabled) {
            transform: scale(0.95);
            filter: brightness(0.9);
        }
        
        .btn-touch:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .music-wave {
            animation: wave 1.2s linear infinite;
        }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }
        
        .correct-answer {
            animation: correctPulse 0.6s ease;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* YouTube Player Container */
        #player {
            position: fixed;
            top: -9999px;
            left: -9999px;
        }
        
        /* ã‚¹ãƒãƒ›ç”¨ã®å¤§ããªãƒœã‚¿ãƒ³ */
        .mobile-btn {
            min-height: 60px;
            font-size: 1.125rem;
        }
        
        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã®æœ€é©åŒ– */
        .player-card {
            min-height: 80px;
        }
        
        /* ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        .swipe-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
    </style>
</head>
<body class="gradient-cyan-teal min-h-screen">
    <!-- YouTube Player (éè¡¨ç¤º) -->
    <div id="player"></div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="container mx-auto px-4 py-4 max-w-md pb-20">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="text-center mb-6">
            <h1 class="text-4xl font-black text-white mb-2 drop-shadow-lg">
                ğŸµ ã‚¤ãƒ³ãƒˆãƒ­ã‚¯ã‚¤ã‚º
            </h1>
            <p class="text-base text-white/90 drop-shadow">ã‚¹ãƒãƒ›æœ€é©åŒ–ç‰ˆ</p>
            
            <!-- YouTube Player ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
            <div id="playerStatus" class="mt-3 text-sm">
                <span class="text-yellow-300">â³ YouTube Playeræº–å‚™ä¸­...</span>
            </div>
        </header>

        <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒªã‚¢ -->
        <div id="app">
            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ -->
            <div id="userManagement" class="space-y-4">
                <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç† -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">ğŸ‘¥</span>
                        ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
                    </h2>
                    
                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="mb-4">
                        <label for="newPlayerName" class="sr-only">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label>
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                id="newPlayerName" 
                                placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å"
                                aria-label="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›"
                                maxlength="15"
                                style="min-width: 0; flex: 1 1 0%;"
                                class="px-4 py-4 rounded-2xl bg-white/20 text-white placeholder-white/60 border border-white/30 focus:outline-none focus:ring-2 focus:ring-white/50"
                            />
                            <button 
                                onclick="addPlayer()"
                                class="px-6 py-4 bg-white text-cyan-600 rounded-2xl font-bold btn-touch flex-shrink-0"
                                aria-label="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ "
                            >
                                è¿½åŠ 
                            </button>
                        </div>
                    </div>
                    
                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ -->
                    <div id="playerList" class="space-y-3 mb-4">
                        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã¯JSã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                    
                    <div class="text-xs text-white/70 text-center">
                        â€» æœ€å¤§4äººã¾ã§ç™»éŒ²å¯èƒ½
                    </div>
                </div>

                <!-- ãƒ†ãƒ¼ãƒã‚¯ã‚¤ã‚ºï¼ˆNEWï¼‰ -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">ğŸ¯</span>
                        ãƒ†ãƒ¼ãƒã‚¯ã‚¤ã‚º
                    </h2>
                    
                    <!-- ã‚¯ã‚¤ã‚ºè¨­å®š -->
                    <div class="glass-effect rounded-xl p-4 mb-4 space-y-3">
                        <!-- æ›²æ•°é¸æŠ -->
                        <div>
                            <label class="text-white text-sm font-semibold block mb-2">ğŸ“Š æ›²æ•°</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="setQuizSongCount(5)" id="songCount5" class="py-2 bg-white/20 text-white rounded-lg btn-touch text-sm font-semibold">
                                    5æ›²
                                </button>
                                <button onclick="setQuizSongCount(10)" id="songCount10" class="py-2 bg-white/40 text-white rounded-lg btn-touch text-sm font-semibold border-2 border-white">
                                    10æ›²
                                </button>
                                <button onclick="setQuizSongCount(20)" id="songCount20" class="py-2 bg-white/20 text-white rounded-lg btn-touch text-sm font-semibold">
                                    20æ›²
                                </button>
                            </div>
                        </div>
                        
                        <!-- é›£æ˜“åº¦é¸æŠ -->
                        <div>
                            <label class="text-white text-sm font-semibold block mb-2">âš¡ é›£æ˜“åº¦</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="setQuizDifficulty('easy')" id="diffEasy" class="py-2 bg-white/20 text-white rounded-lg btn-touch text-sm font-semibold">
                                    ğŸ˜Š ç°¡å˜<br><span class="text-xs">(10ç§’)</span>
                                </button>
                                <button onclick="setQuizDifficulty('normal')" id="diffNormal" class="py-2 bg-white/40 text-white rounded-lg btn-touch text-sm font-semibold border-2 border-white">
                                    ğŸµ æ™®é€š<br><span class="text-xs">(5ç§’)</span>
                                </button>
                                <button onclick="setQuizDifficulty('hard')" id="diffHard" class="py-2 bg-white/20 text-white rounded-lg btn-touch text-sm font-semibold">
                                    ğŸ”¥ é›£ã—ã„<br><span class="text-xs">(3ç§’)</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-white/80 text-sm mb-4">
                        ãƒ†ãƒ¼ãƒã‚’é¸ã‚“ã§è‡ªå‹•çš„ã«æ›²ã‚’é¸æŠï¼
                    </p>
                    
                    <!-- ãƒ†ãƒ¼ãƒãƒœã‚¿ãƒ³ -->
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <button 
                            onclick="startThemeQuiz('2000å¹´ ãƒ’ãƒƒãƒˆæ›² J-POP')"
                            class="py-4 bg-gradient-to-br from-purple-500 to-pink-500 text-white font-bold rounded-xl btn-touch shadow-lg"
                        >
                            ğŸµ 2000å¹´ä»£<br>ãƒ’ãƒƒãƒˆæ›²
                        </button>
                        <button 
                            onclick="startThemeQuiz('2010å¹´ ãƒ’ãƒƒãƒˆæ›² J-POP')"
                            class="py-4 bg-gradient-to-br from-blue-500 to-cyan-500 text-white font-bold rounded-xl btn-touch shadow-lg"
                        >
                            ğŸ¤ 2010å¹´ä»£<br>ãƒ’ãƒƒãƒˆæ›²
                        </button>
                        <button 
                            onclick="startThemeQuiz('1990å¹´ ãƒ’ãƒƒãƒˆæ›² J-POP')"
                            class="py-4 bg-gradient-to-br from-green-500 to-teal-500 text-white font-bold rounded-xl btn-touch shadow-lg"
                        >
                            ğŸ’¿ 1990å¹´ä»£<br>ãƒ’ãƒƒãƒˆæ›²
                        </button>
                        <button 
                            onclick="startThemeQuiz('ã‚¢ãƒ‹ãƒ¡ã‚½ãƒ³ã‚° äººæ°—')"
                            class="py-4 bg-gradient-to-br from-red-500 to-orange-500 text-white font-bold rounded-xl btn-touch shadow-lg"
                        >
                            ğŸŒŸ ã‚¢ãƒ‹ãƒ¡<br>ã‚½ãƒ³ã‚°
                        </button>
                        <button 
                            onclick="startThemeQuiz('ãƒ‰ãƒ©ãƒ ä¸»é¡Œæ­Œ æ—¥æœ¬')"
                            class="py-4 bg-gradient-to-br from-yellow-500 to-orange-400 text-white font-bold rounded-xl btn-touch shadow-lg"
                        >
                            ğŸ“º ãƒ‰ãƒ©ãƒ<br>ä¸»é¡Œæ­Œ
                        </button>
                    </div>
                    
                    <!-- ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæŒ‡å®šã‚¯ã‚¤ã‚º -->
                    <div class="glass-effect rounded-xl p-4 mb-3">
                        <h3 class="text-white text-sm font-semibold mb-2 flex items-center gap-2">
                            <span>ğŸ¤</span>
                            ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæŒ‡å®šã‚¯ã‚¤ã‚º
                        </h3>
                        <label for="artistName" class="sr-only">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå</label>
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                id="artistName" 
                                placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã‚’å…¥åŠ›"
                                aria-label="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã‚’å…¥åŠ›"
                                style="min-width: 0; flex: 1 1 0%;"
                                class="px-4 py-3 rounded-xl bg-white/20 text-white placeholder-white/60 border border-white/30 focus:outline-none focus:ring-2 focus:ring-white/50"
                            />
                            <button 
                                onclick="startArtistQuiz()"
                                class="px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-xl font-bold btn-touch flex-shrink-0 shadow-lg"
                                aria-label="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæŒ‡å®šã‚¯ã‚¤ã‚ºã‚’é–‹å§‹"
                            >
                                é–‹å§‹
                            </button>
                        </div>
                    </div>
                    
                    <div class="text-xs text-white/60 text-center">
                        â€» ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™»éŒ²å¾Œã«é¸æŠã—ã¦ãã ã•ã„
                    </div>
                </div>

                <!-- YouTubeæ¤œç´¢ -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">ğŸ¬</span>
                        æ‰‹å‹•ã§æ›²ã‚’æ¤œç´¢
                    </h2>
                    
                    <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div class="mb-4">
                        <label for="searchQuery" class="sr-only">æ›²åã§æ¤œç´¢</label>
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                id="searchQuery" 
                                placeholder="æ›²åã§æ¤œç´¢"
                                aria-label="æ›²åã§æ¤œç´¢"
                                style="min-width: 0; flex: 1 1 0%;"
                                class="px-4 py-3 rounded-xl bg-white/20 text-white placeholder-white/60 border border-white/30 focus:outline-none focus:ring-2 focus:ring-white/50"
                            />
                            <button 
                                onclick="searchYouTube()"
                                class="px-6 py-3 bg-white text-cyan-600 rounded-xl font-bold btn-touch flex-shrink-0"
                                aria-label="æ›²ã‚’æ¤œç´¢"
                            >
                                æ¤œç´¢
                        </button>
                    </div>
                    
                    <!-- æ¤œç´¢çµæœ -->
                    <div id="searchResults" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- æ¤œç´¢çµæœã¯JSã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                    
                    <!-- é¸æŠæ¸ˆã¿æ›²ãƒªã‚¹ãƒˆ -->
                    <div class="mt-4">
                        <h3 class="text-white font-semibold mb-2 text-sm">é¸æŠæ¸ˆã¿: <span id="selectedCount">0</span>æ›²</h3>
                        <div id="selectedSongs" class="space-y-2 max-h-96 overflow-y-auto">
                            <!-- é¸æŠæ¸ˆã¿æ›²ã¯JSã§å‹•çš„ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- ã‚¯ã‚¤ã‚ºè¨­å®š -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">âš™ï¸</span>
                        è¨­å®š
                    </h2>
                    
                    <!-- ã‚¤ãƒ³ãƒˆãƒ­å†ç”Ÿæ™‚é–“ -->
                    <div class="mb-4">
                        <label class="block text-white font-semibold mb-2">
                            ã‚¤ãƒ³ãƒˆãƒ­æ™‚é–“: <span id="introTimeDisplay" class="text-cyan-200">5</span>ç§’
                        </label>
                        <input 
                            type="range" 
                            id="introTime" 
                            min="3" 
                            max="15" 
                            value="5"
                            class="w-full h-3 bg-white/30 rounded-lg appearance-none cursor-pointer accent-white"
                        />
                        <div class="flex justify-between text-xs text-white/60 mt-1">
                            <span>3ç§’</span>
                            <span>15ç§’</span>
                        </div>
                    </div>
                    
                    <!-- ã‚¯ã‚¤ã‚ºé–‹å§‹ãƒœã‚¿ãƒ³ -->
                    <button 
                        onclick="startQuiz()"
                        class="w-full py-5 bg-gradient-to-r from-pink-500 to-purple-600 text-white text-xl font-bold rounded-2xl btn-touch shadow-lg mobile-btn"
                        aria-label="ã‚¤ãƒ³ãƒˆãƒ­ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹"
                    >
                        ğŸµ ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹
                    </button>
                </div>

                <!-- ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ -->
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                        <span class="text-3xl">ğŸ†</span>
                        ã‚¹ã‚³ã‚¢
                    </h2>
                    <div id="scoreBoard" class="space-y-2">
                        <!-- ã‚¹ã‚³ã‚¢ã¯JSã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                    <button 
                        onclick="clearScores()"
                        class="mt-4 w-full py-3 bg-red-500/80 text-white font-bold rounded-xl btn-touch"
                    >
                        ã‚¹ã‚³ã‚¢ã‚’ã‚¯ãƒªã‚¢
                    </button>
                </div>
            </div>

            <!-- ã‚¯ã‚¤ã‚ºå®Ÿè¡Œç”»é¢ -->
            <div id="quizGame" class="hidden space-y-4">
                <div class="glass-effect rounded-3xl p-5 shadow-2xl">
                    <!-- ã‚¯ã‚¤ã‚ºãƒ˜ãƒƒãƒ€ãƒ¼ -->
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                            <span class="text-3xl">ğŸµ</span>
                            ã‚¯ã‚¤ã‚ºä¸­
                        </h2>
                        <button 
                            onclick="endQuiz()"
                            class="px-4 py-2 bg-red-500/80 text-white font-bold rounded-xl btn-touch text-sm"
                        >
                            çµ‚äº†
                        </button>
                    </div>
                    
                    <!-- é€²æ—è¡¨ç¤º -->
                    <div class="mb-4">
                        <div class="flex justify-between text-white text-sm mb-2">
                            <span id="currentQuestion">å•é¡Œ 1/?</span>
                            <span id="timer" class="font-bold">--</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div id="progressBar" class="bg-white h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- éŸ³æ¥½æ³¢å½¢ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ -->
                    <div class="flex justify-center items-end gap-1 h-24 mb-4 bg-white/10 rounded-2xl p-3">
                        <div class="w-2 bg-white/60 rounded-full music-wave" style="height: 20%; animation-delay: 0s;"></div>
                        <div class="w-2 bg-white/70 rounded-full music-wave" style="height: 40%; animation-delay: 0.1s;"></div>
                        <div class="w-2 bg-white/80 rounded-full music-wave" style="height: 60%; animation-delay: 0.2s;"></div>
                        <div class="w-2 bg-white/90 rounded-full music-wave" style="height: 80%; animation-delay: 0.3s;"></div>
                        <div class="w-2 bg-white rounded-full music-wave" style="height: 100%; animation-delay: 0.4s;"></div>
                        <div class="w-2 bg-white/90 rounded-full music-wave" style="height: 80%; animation-delay: 0.5s;"></div>
                        <div class="w-2 bg-white/80 rounded-full music-wave" style="height: 60%; animation-delay: 0.6s;"></div>
                        <div class="w-2 bg-white/70 rounded-full music-wave" style="height: 40%; animation-delay: 0.7s;"></div>
                        <div class="w-2 bg-white/60 rounded-full music-wave" style="height: 20%; animation-delay: 0.8s;"></div>
                    </div>
                    
                    <!-- ç¾åœ¨ã®æ›²æƒ…å ± -->
                    <div class="text-center mb-4">
                        <p class="text-white/70 text-sm mb-2">ã“ã®æ›²ã®ã‚¿ã‚¤ãƒˆãƒ«ã¯?</p>
                        <p id="currentSongTitle" class="text-lg font-bold text-white hidden">æ›²åãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                    
                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒœã‚¿ãƒ³ -->
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div id="playerButtons" class="col-span-2 grid grid-cols-2 gap-3">
                            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒœã‚¿ãƒ³ã¯JSã§å‹•çš„ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <button 
                                onclick="playIntro()"
                                id="playButton"
                                class="py-5 bg-white text-cyan-600 font-bold rounded-2xl btn-touch shadow-lg mobile-btn"
                            >
                                â–¶ï¸ å†ç”Ÿ
                            </button>
                            <button 
                                onclick="pauseIntro()"
                                id="pauseButton"
                                class="py-5 bg-orange-500 text-white font-bold rounded-2xl btn-touch shadow-lg mobile-btn"
                                disabled
                            >
                                â¸ï¸ åœæ­¢
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <button 
                                onclick="showAnswer()"
                                id="showAnswerButton"
                                class="py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold rounded-2xl btn-touch shadow-lg"
                            >
                                ğŸ’¡ ç­”ãˆ
                            </button>
                            <button 
                                onclick="nextQuestion()"
                                id="nextButton"
                                class="py-4 bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold rounded-2xl btn-touch shadow-lg"
                            >
                                â¡ï¸ æ¬¡ã¸
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let players = JSON.parse(localStorage.getItem('quizPlayers')) || [];
        let scores = JSON.parse(localStorage.getItem('quizScores')) || {};
        let selectedSongs = JSON.parse(localStorage.getItem('selectedSongs')) || []; // æ›²ã‚’ä¿æŒ
        let currentQuestionIndex = 0;
        let introTime = 5;
        let questionAnswered = false;
        let ytPlayer = null;
        let playbackTimer = null;
        let nextPageToken = null; // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨
        let currentSearchQuery = ''; // ç¾åœ¨ã®æ¤œç´¢ã‚¯ã‚¨ãƒª
        let isPlaying = false; // å†ç”ŸçŠ¶æ…‹
        let videoLoaded = false; // å‹•ç”»ãƒ­ãƒ¼ãƒ‰å®Œäº†ãƒ•ãƒ©ã‚°
        let playerReady = false; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æº–å‚™å®Œäº†ãƒ•ãƒ©ã‚°
        
        // ã‚¯ã‚¤ã‚ºè¨­å®š
        let quizSongCount = 10; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯10æ›²
        let quizDifficulty = 'normal'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯æ™®é€š
        const difficultySettings = {
            easy: 10,
            normal: 5,
            hard: 3
        };

        // YouTube IFrame APIæº–å‚™å®Œäº†
        function onYouTubeIframeAPIReady() {
            console.log('onYouTubeIframeAPIReady å‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ');
            try {
                ytPlayer = new YT.Player('player', {
                    height: '0',
                    width: '0',
                    playerVars: {
                        'playsinline': 1,
                        'controls': 0,
                        'enablejsapi': 1
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError
                    }
                });
                console.log('YouTube Playerä½œæˆæˆåŠŸ');
            } catch (error) {
                console.error('YouTube Playerä½œæˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        function onPlayerError(event) {
            console.error('YouTube Player Error:', event.data);
            const errorMessages = {
                2: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã¾ã™',
                5: 'HTML5ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¨ãƒ©ãƒ¼ã§ã™',
                100: 'ã“ã®å‹•ç”»ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ',
                101: 'ã“ã®å‹•ç”»ã®æ‰€æœ‰è€…ãŒåŸ‹ã‚è¾¼ã¿å†ç”Ÿã‚’è¨±å¯ã—ã¦ã„ã¾ã›ã‚“',
                150: 'ã“ã®å‹•ç”»ã®æ‰€æœ‰è€…ãŒåŸ‹ã‚è¾¼ã¿å†ç”Ÿã‚’è¨±å¯ã—ã¦ã„ã¾ã›ã‚“'
            };
            
            const message = errorMessages[event.data] || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
            console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', message);
            
            // æ¬¡ã®æ›²ã«é€²ã‚€
            if (typeof nextQuestion === 'function') {
                alert(message + '\næ¬¡ã®æ›²ã«é€²ã¿ã¾ã™ã€‚');
                nextQuestion();
            }
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æº–å‚™å®Œäº†
        function onPlayerReady(event) {
            // ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ï¼ˆéŸ³ãŒå‡ºã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰
            event.target.unMute();
            event.target.setVolume(100);
            playerReady = true; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æº–å‚™å®Œäº†
            console.log('YouTube Playeræº–å‚™å®Œäº†');
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°
            const statusElement = document.getElementById('playerStatus');
            if (statusElement) {
                statusElement.innerHTML = '<span class="text-green-300">âœ… YouTube Playeræº–å‚™å®Œäº†</span>';
                // 3ç§’å¾Œã«éè¡¨ç¤º
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 3000);
            }
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹å¤‰æ›´
        function onPlayerStateChange(event) {
            // å‹•ç”»ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰ï¼ˆCUED = 5ï¼‰
            if (event.data === 5 || event.data === 1) {
                videoLoaded = true;
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded');
            updatePlayerList();
            updateScoreBoard();
            updateSelectedSongs(); // ä¿å­˜ã•ã‚Œã¦ã„ã‚‹æ›²ã‚’è¡¨ç¤º
            
            // YouTube APIãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦æ‰‹å‹•åˆæœŸåŒ–
            let initAttempts = 0;
            const maxAttempts = 10;
            
            const tryInitYouTubePlayer = () => {
                initAttempts++;
                console.log(`YouTube PlayeråˆæœŸåŒ–è©¦è¡Œ ${initAttempts}/${maxAttempts}`);
                
                const statusElement = document.getElementById('playerStatus');
                if (statusElement) {
                    statusElement.innerHTML = `<span class="text-yellow-300">â³ YouTube Playeræº–å‚™ä¸­... (${initAttempts}/${maxAttempts})</span>`;
                }
                
                if (typeof YT !== 'undefined' && typeof YT.Player !== 'undefined') {
                    console.log('YouTube APIåˆ©ç”¨å¯èƒ½');
                    
                    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã¾ã åˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿åˆæœŸåŒ–
                    if (!ytPlayer) {
                        console.log('æ‰‹å‹•ã§YouTube PlayeråˆæœŸåŒ–ã‚’é–‹å§‹');
                        onYouTubeIframeAPIReady();
                    } else {
                        console.log('YouTube Playeræ—¢ã«åˆæœŸåŒ–æ¸ˆã¿');
                    }
                } else {
                    console.log('YouTube APIæœªãƒ­ãƒ¼ãƒ‰ã€å¾…æ©Ÿä¸­...');
                    if (initAttempts < maxAttempts) {
                        setTimeout(tryInitYouTubePlayer, 1000);
                    } else {
                        console.error('YouTube APIã®èª­ã¿è¾¼ã¿ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
                        if (statusElement) {
                            statusElement.innerHTML = '<span class="text-red-300">âŒ YouTube APIã®èª­ã¿è¾¼ã¿å¤±æ•—</span>';
                        }
                        alert('YouTube APIã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                    }
                }
            };
            
            // 500mså¾Œã«åˆæœŸåŒ–ã‚’è©¦è¡Œ
            setTimeout(tryInitYouTubePlayer, 500);
            
            // ã‚¤ãƒ³ãƒˆãƒ­æ™‚é–“ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
            document.getElementById('introTime').addEventListener('input', function(e) {
                introTime = parseInt(e.target.value);
                document.getElementById('introTimeDisplay').textContent = introTime;
            });
        });

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ 
        function addPlayer() {
            const input = document.getElementById('newPlayerName');
            const name = input.value.trim();
            
            if (!name) {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (players.length >= 4) {
                alert('æœ€å¤§4äººã¾ã§ã§ã™');
                return;
            }
            
            if (players.some(p => p.name === name)) {
                alert('åŒã˜åå‰ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }
            
            const player = {
                id: Date.now(),
                name: name
            };
            
            players.push(player);
            if (!scores[player.id]) {
                scores[player.id] = 0;
            }
            
            savePlayers();
            saveScores();
            updatePlayerList();
            updateScoreBoard();
            input.value = '';
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤
        function removePlayer(playerId) {
            if (confirm('ã“ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {
                players = players.filter(p => p.id !== playerId);
                savePlayers();
                updatePlayerList();
                updateScoreBoard();
            }
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆæ›´æ–°
        function updatePlayerList() {
            const container = document.getElementById('playerList');
            
            if (players.length === 0) {
                container.innerHTML = '<div class="text-center text-white/60 py-4 text-sm">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            container.innerHTML = players.map(player => `
                <div class="glass-effect rounded-2xl p-4 flex items-center justify-between player-card">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            ${player.name.charAt(0).toUpperCase()}
                        </div>
                        <span class="text-white font-semibold">${player.name}</span>
                    </div>
                    <button 
                        onclick="removePlayer(${player.id})"
                        class="text-red-300 hover:text-red-100 font-bold text-2xl w-10 h-10 flex items-center justify-center"
                    >
                        âœ•
                    </button>
                </div>
            `).join('');
        }

        // ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰æ›´æ–°
        function updateScoreBoard() {
            const container = document.getElementById('scoreBoard');
            
            if (players.length === 0) {
                container.innerHTML = '<div class="text-center text-white/60 py-3 text-sm">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ã¾ã›ã‚“</div>';
                return;
            }
            
            const sortedPlayers = [...players].sort((a, b) => (scores[b.id] || 0) - (scores[a.id] || 0));
            
            container.innerHTML = sortedPlayers.map((player, index) => {
                const score = scores[player.id] || 0;
                const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
                const medal = index < 3 ? medals[index] : 'ğŸ…';
                
                return `
                    <div class="flex items-center justify-between bg-white/10 rounded-xl p-3">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">${medal}</span>
                            <span class="text-white font-semibold">${player.name}</span>
                        </div>
                        <span class="text-xl font-bold text-white">${score}pt</span>
                    </div>
                `;
            }).join('');
        }

        // ã‚¹ã‚³ã‚¢ã‚¯ãƒªã‚¢
        function clearScores() {
            if (confirm('å…¨ã¦ã®ã‚¹ã‚³ã‚¢ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹?')) {
                scores = {};
                players.forEach(player => {
                    scores[player.id] = 0;
                });
                saveScores();
                updateScoreBoard();
            }
        }        
        // APIã‚­ãƒ¼ã‚’å–å¾—
        function getApiKey() {
            // 1. LocalStorageã‹ã‚‰å–å¾—ï¼ˆGitHub Pagesç”¨ï¼‰
            const storedKey = localStorage.getItem('youtubeApiKey');
            if (storedKey) {
                return storedKey;
            }
            
            // 2. config.jsã‹ã‚‰å–å¾—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼‰
            if (typeof CONFIG !== 'undefined' && CONFIG.YOUTUBE_API_KEY) {
                return CONFIG.YOUTUBE_API_KEY;
            }
            
            // 3. å–å¾—ã§ããªã„å ´åˆ
            return null;
        }

        // YouTubeæ¤œç´¢
        async function searchYouTube(clearResults = true) {
            // APIã‚­ãƒ¼ã‚’å–å¾—
            const apiKey = getApiKey();
            
            if (!apiKey) {
                if (confirm('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nè¨­å®šãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ')) {
                    window.location.href = 'setup.html';
                }
                return;
            }
            
            const query = document.getElementById('searchQuery').value.trim();
            
            if (!query) {
                alert('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // æ–°ã—ã„æ¤œç´¢ã®å ´åˆã¯ãƒªã‚»ãƒƒãƒˆ
            if (clearResults) {
                nextPageToken = null;
                currentSearchQuery = query;
            }
            
            const container = document.getElementById('searchResults');
            
            if (clearResults) {
                container.innerHTML = '<div class="text-white/70 text-center py-3 text-sm">æ¤œç´¢ä¸­...</div>';
            } else {
                // ã€Œã‚‚ã£ã¨è¦‹ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã€Œèª­ã¿è¾¼ã¿ä¸­...ã€ã«å¤‰æ›´
                const loadMoreBtn = document.getElementById('loadMoreBtn');
                if (loadMoreBtn) {
                    loadMoreBtn.textContent = 'èª­ã¿è¾¼ã¿ä¸­...';
                    loadMoreBtn.disabled = true;
                }
            }
            
            try {
                let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query + ' music')}&type=video&videoCategoryId=10&maxResults=30&key=${apiKey}`;
                
                // ãƒšãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚‹å ´åˆã¯è¿½åŠ 
                if (!clearResults && nextPageToken) {
                    url += `&pageToken=${nextPageToken}`;
                }
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                const data = await response.json();
                
                // æ¬¡ã®ãƒšãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
                nextPageToken = data.nextPageToken || null;
                
                if (!data.items || data.items.length === 0) {
                    if (clearResults) {
                        container.innerHTML = '<div class="text-white/70 text-center py-3 text-sm">çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
                    }
                    return;
                }
                
                const resultHTML = data.items.map(item => `
                    <div class="bg-white/10 rounded-xl p-3 flex items-center gap-3">
                        <img src="${item.snippet.thumbnails.default.url}" alt="${item.snippet.title}" class="w-16 h-12 rounded object-cover" />
                        <div class="flex-1 min-w-0">
                            <p class="text-white text-sm font-semibold truncate">${item.snippet.title}</p>
                            <p class="text-white/60 text-xs truncate">${item.snippet.channelTitle}</p>
                        </div>
                        <button 
                            onclick="addSong('${item.id.videoId}', '${item.snippet.title.replace(/'/g, "\\'")}', '${item.snippet.thumbnails.default.url}')"
                            class="px-3 py-2 bg-cyan-500 text-white rounded-lg btn-touch text-xs font-bold flex-shrink-0"
                            aria-label="${item.snippet.title}ã‚’è¿½åŠ "
                        >
                            è¿½åŠ 
                        </button>
                    </div>
                `).join('');
                
                // ã€Œã‚‚ã£ã¨è¦‹ã‚‹ã€ãƒœã‚¿ãƒ³ã®HTML
                const loadMoreHTML = nextPageToken ? `
                    <button 
                        id="loadMoreBtn"
                        onclick="loadMoreResults()"
                        class="w-full py-3 bg-white/20 text-white font-bold rounded-xl btn-touch text-sm mt-2"
                    >
                        â¬‡ï¸ ã‚‚ã£ã¨è¦‹ã‚‹ï¼ˆ${data.items.length}ä»¶è¿½åŠ è¡¨ç¤ºï¼‰
                    </button>
                ` : '';
                
                if (clearResults) {
                    container.innerHTML = resultHTML + loadMoreHTML;
                } else {
                    // æ—¢å­˜ã®çµæœã«è¿½åŠ 
                    const existingHTML = container.innerHTML.replace(/<button[^>]*id="loadMoreBtn"[^>]*>.*?<\/button>/s, '');
                    container.innerHTML = existingHTML + resultHTML + loadMoreHTML;
                }
                
            } catch (error) {
                if (clearResults) {
                    container.innerHTML = '<div class="text-red-300 text-center py-3 text-sm">ã‚¨ãƒ©ãƒ¼: ' + error.message + '</div>';
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
                }
            }
        }
        
        // ã‚‚ã£ã¨è¦‹ã‚‹ãƒœã‚¿ãƒ³
        async function loadMoreResults() {
            await searchYouTube(false);
        }
        
        // æ›²æ•°è¨­å®š
        function setQuizSongCount(count) {
            quizSongCount = count;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
            ['songCount5', 'songCount10', 'songCount20'].forEach(id => {
                const btn = document.getElementById(id);
                if (id === 'songCount' + count) {
                    btn.className = 'py-2 bg-white/40 text-white rounded-lg btn-touch text-sm font-semibold border-2 border-white';
                } else {
                    btn.className = 'py-2 bg-white/20 text-white rounded-lg btn-touch text-sm font-semibold';
                }
            });
        }
        
        // é›£æ˜“åº¦è¨­å®š
        function setQuizDifficulty(difficulty) {
            quizDifficulty = difficulty;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
            ['diffEasy', 'diffNormal', 'diffHard'].forEach(id => {
                const btn = document.getElementById(id);
                if (id === 'diff' + difficulty.charAt(0).toUpperCase() + difficulty.slice(1)) {
                    btn.className = 'py-2 bg-white/40 text-white rounded-lg btn-touch text-sm font-semibold border-2 border-white';
                } else {
                    btn.className = 'py-2 bg-white/20 text-white rounded-lg btn-touch text-sm font-semibold';
                }
            });
            
            // ã‚¤ãƒ³ãƒˆãƒ­æ™‚é–“ã‚’è‡ªå‹•è¨­å®š
            introTime = difficultySettings[difficulty];
            document.getElementById('introTime').value = introTime;
            document.getElementById('introTimeDisplay').textContent = introTime;
        }
        
        // ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæŒ‡å®šã‚¯ã‚¤ã‚º
        async function startArtistQuiz() {
            const artistName = document.getElementById('artistName').value.trim();
            
            if (!artistName) {
                alert('ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã§æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’ä½œæˆ
            const searchQuery = `${artistName} æ›²`;
            await startThemeQuiz(searchQuery);
        }

        // ãƒ†ãƒ¼ãƒã‚¯ã‚¤ã‚ºã‚’é–‹å§‹
        async function startThemeQuiz(theme) {
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒã‚§ãƒƒã‚¯
            if (players.length === 0) {
                alert('å…ˆã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„');
                return;
            }
            
            // YouTube Playerãƒã‚§ãƒƒã‚¯
            if (!ytPlayer || !playerReady) {
                alert('YouTube Playerã®æº–å‚™ãŒã§ãã¦ã„ã¾ã›ã‚“ã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            const difficultyText = quizDifficulty === 'easy' ? 'ç°¡å˜(10ç§’)' : quizDifficulty === 'normal' ? 'æ™®é€š(5ç§’)' : 'é›£ã—ã„(3ç§’)';
            if (!confirm(`ã€Œ${theme}ã€ã®ãƒ†ãƒ¼ãƒã§${quizSongCount}æ›²ã‚’è‡ªå‹•é¸æŠã—ã¦ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ\n\né›£æ˜“åº¦: ${difficultyText}\nâ€» ç¾åœ¨é¸æŠä¸­ã®æ›²ã¯ã‚¯ãƒªã‚¢ã•ã‚Œã¾ã™`)) {
                return;
            }
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'themeLoadingOverlay';
            loadingDiv.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50';
            loadingDiv.innerHTML = `
                <div class="bg-white/10 rounded-3xl p-8 max-w-sm mx-4">
                    <div class="text-center text-white">
                        <div class="text-4xl mb-4">ğŸµ</div>
                        <h3 class="text-xl font-bold mb-2">æ›²ã‚’é¸ã‚“ã§ã„ã¾ã™...</h3>
                        <p class="text-sm text-white/80 mb-4">${theme}</p>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div id="themeLoadingProgress" class="bg-white h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="themeLoadingStatus" class="text-xs text-white/60 mt-2">æ¤œç´¢ä¸­...</p>
                    </div>
                </div>
            `;
            document.body.appendChild(loadingDiv);
            
            try {
                // APIã‚­ãƒ¼å–å¾—
                const apiKey = getApiKey();
                if (!apiKey) {
                    throw new Error('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // é€²æ—æ›´æ–°
                document.getElementById('themeLoadingProgress').style.width = '30%';
                document.getElementById('themeLoadingStatus').textContent = 'YouTubeæ¤œç´¢ä¸­...';
                
                // YouTubeæ¤œç´¢ï¼ˆå¤šã‚ã«å–å¾—ï¼‰
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(theme)}&type=video&videoCategoryId=10&maxResults=50&key=${apiKey}`
                );
                
                if (!response.ok) {
                    throw new Error('æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                const data = await response.json();
                
                if (!data.items || data.items.length === 0) {
                    throw new Error('æ›²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }
                
                // é€²æ—æ›´æ–°
                document.getElementById('themeLoadingProgress').style.width = '60%';
                document.getElementById('themeLoadingStatus').textContent = `${data.items.length}æ›²è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ...`;
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã«æŒ‡å®šæ›²æ•°ï¼ˆã¾ãŸã¯åˆ©ç”¨å¯èƒ½ãªæ›²æ•°ï¼‰ã‚’é¸æŠ
                const songsToSelect = Math.min(quizSongCount, data.items.length);
                const shuffledItems = [...data.items].sort(() => Math.random() - 0.5);
                const selectedItems = shuffledItems.slice(0, songsToSelect);
                
                // æ›²ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦æ–°ã—ã„æ›²ã‚’è¿½åŠ 
                selectedSongs = [];
                selectedItems.forEach(item => {
                    selectedSongs.push({
                        videoId: item.id.videoId,
                        title: item.snippet.title,
                        thumbnail: item.snippet.thumbnails.default.url
                    });
                });
                
                saveSelectedSongs();
                updateSelectedSongs();
                
                // é›£æ˜“åº¦ã«å¿œã˜ã¦ã‚¤ãƒ³ãƒˆãƒ­æ™‚é–“ã‚’è¨­å®š
                introTime = difficultySettings[quizDifficulty];
                document.getElementById('introTime').value = introTime;
                document.getElementById('introTimeDisplay').textContent = introTime;
                
                // é€²æ—æ›´æ–°
                document.getElementById('themeLoadingProgress').style.width = '90%';
                document.getElementById('themeLoadingStatus').textContent = `${songsToSelect}æ›²ã‚’é¸æŠã—ã¾ã—ãŸ...`;
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // é€²æ—å®Œäº†
                document.getElementById('themeLoadingProgress').style.width = '100%';
                document.getElementById('themeLoadingStatus').textContent = 'ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã—ã¾ã™ï¼';
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‰Šé™¤
                document.body.removeChild(loadingDiv);
                
                // ã‚¯ã‚¤ã‚ºé–‹å§‹
                startQuiz();
                
            } catch (error) {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‰Šé™¤
                if (document.getElementById('themeLoadingOverlay')) {
                    document.body.removeChild(loadingDiv);
                }
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // æ›²ã‚’è¿½åŠ 
        function addSong(videoId, title, thumbnail) {
            if (selectedSongs.some(s => s.videoId === videoId)) {
                alert('ã“ã®æ›²ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
                return;
            }
            
            selectedSongs.push({ videoId, title, thumbnail });
            saveSelectedSongs(); // LocalStorageã«ä¿å­˜
            updateSelectedSongs();
        }

        // é¸æŠæ¸ˆã¿æ›²ã‚’å‰Šé™¤
        function removeSong(videoId) {
            selectedSongs = selectedSongs.filter(s => s.videoId !== videoId);
            saveSelectedSongs(); // LocalStorageã«ä¿å­˜
            updateSelectedSongs();
        }

        // é¸æŠæ¸ˆã¿æ›²ãƒªã‚¹ãƒˆæ›´æ–°
        function updateSelectedSongs() {
            const container = document.getElementById('selectedSongs');
            const countDisplay = document.getElementById('selectedCount');
            
            countDisplay.textContent = selectedSongs.length;
            
            if (selectedSongs.length === 0) {
                container.innerHTML = '<div class="text-white/60 text-center py-2 text-xs">æ›²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            container.innerHTML = selectedSongs.map(song => `
                <div class="bg-white/10 rounded-lg p-2 flex items-center gap-2">
                    <img src="${song.thumbnail}" alt="${song.title}" class="w-12 h-9 rounded object-cover" />
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-xs truncate">${song.title}</p>
                    </div>
                    <button 
                        onclick="removeSong('${song.videoId}')"
                        class="text-red-300 font-bold text-lg w-8 h-8 flex items-center justify-center"
                        aria-label="${song.title}ã‚’å‰Šé™¤"
                    >
                        âœ•
                    </button>
                </div>
            `).join('');
        }

        // ã‚¯ã‚¤ã‚ºé–‹å§‹
        function startQuiz() {
            if (players.length === 0) {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (selectedSongs.length === 0) {
                alert('æ›²ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!ytPlayer || !playerReady) {
                alert('YouTube Playerã®æº–å‚™ãŒã§ãã¦ã„ã¾ã›ã‚“ã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§éŸ³å£°ã‚’æœ‰åŠ¹åŒ–ï¼ˆé‡è¦ï¼ï¼‰
            try {
                ytPlayer.unMute();
                ytPlayer.setVolume(100);
                // ãƒ€ãƒŸãƒ¼å†ç”Ÿã§éŸ³å£°ã‚’ç¢ºå®Ÿã«æœ‰åŠ¹åŒ–ï¼ˆæ™‚é–“ã‚’å°‘ã—é•·ã‚ã«ï¼‰
                ytPlayer.playVideo();
                setTimeout(() => {
                    ytPlayer.pauseVideo();
                }, 300); // 100ms â†’ 300ms ã«å»¶é•·
            } catch (e) {
                console.log('éŸ³å£°åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
            }
            
            currentQuestionIndex = 0;
            shuffleArray(selectedSongs);
            
            document.getElementById('userManagement').classList.add('hidden');
            document.getElementById('quizGame').classList.remove('hidden');
            
            loadQuestion();
        }

        // å•é¡Œèª­ã¿è¾¼ã¿
        function loadQuestion() {
            console.log('loadQuestioné–‹å§‹');
            console.log('currentQuestionIndex:', currentQuestionIndex);
            console.log('selectedSongs:', selectedSongs);
            console.log('players:', players);
            
            questionAnswered = false;
            document.getElementById('currentSongTitle').classList.add('hidden');
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            if (playbackTimer) {
                clearInterval(playbackTimer);
                playbackTimer = null;
            }
            
            // ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
            const timerElement = document.getElementById('timer');
            if (timerElement) {
                timerElement.textContent = '--';
                console.log('ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ');
            } else {
                console.error('timerè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            isPlaying = false;
            const playButton = document.getElementById('playButton');
            const pauseButton = document.getElementById('pauseButton');
            if (playButton && pauseButton) {
                playButton.disabled = false;
                pauseButton.disabled = true;
                console.log('ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ');
            } else {
                console.error('playButton ã¾ãŸã¯ pauseButton ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            const progress = ((currentQuestionIndex + 1) / selectedSongs.length) * 100;
            const progressBar = document.getElementById('progressBar');
            const currentQuestion = document.getElementById('currentQuestion');
            
            if (progressBar) {
                progressBar.style.width = progress + '%';
                console.log('é€²æ—ãƒãƒ¼æ›´æ–°:', progress + '%');
            } else {
                console.error('progressBarè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            if (currentQuestion) {
                currentQuestion.textContent = `å•é¡Œ ${currentQuestionIndex + 1}/${selectedSongs.length}`;
                console.log('å•é¡Œç•ªå·æ›´æ–°:', currentQuestion.textContent);
            } else {
                console.error('currentQuestionè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒœã‚¿ãƒ³ç”Ÿæˆ
            const buttonContainer = document.getElementById('playerButtons');
            buttonContainer.innerHTML = players.map(player => `
                <button 
                    onclick="playerAnswer(${player.id})"
                    class="py-6 bg-gradient-to-br from-purple-500 to-pink-500 text-white font-bold rounded-2xl btn-touch shadow-lg mobile-btn"
                >
                    ${player.name}
                </button>
            `).join('');
            
            // YouTubeå‹•ç”»ã‚’ãƒ­ãƒ¼ãƒ‰ï¼ˆloadVideoByIdã§éŸ³å£°ã‚‚æº–å‚™ï¼‰
            const song = selectedSongs[currentQuestionIndex];
            console.log('ç¾åœ¨ã®æ›²:', song);
            
            if (!song || !song.videoId) {
                console.error('æ›²æƒ…å ±ãŒä¸æ­£ã§ã™:', song);
                alert('æ›²æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ¬¡ã®æ›²ã«é€²ã¿ã¾ã™ã€‚');
                nextQuestion();
                return;
            }
            
            console.log('ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ videoId:', song.videoId);
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæº–å‚™ã§ãã¦ã„ã‚‹ã‹ç¢ºèª
            if (!ytPlayer || !playerReady || typeof ytPlayer.loadVideoById !== 'function') {
                console.error('YouTube Player is not ready');
                alert('YouTube Playerã®æº–å‚™ãŒã§ãã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            try {
                console.log('loadVideoByIdå®Ÿè¡Œé–‹å§‹');
                ytPlayer.loadVideoById({
                    'videoId': song.videoId,
                    'startSeconds': 0
                });
                console.log('loadVideoByIdå®Ÿè¡Œå®Œäº†');
            } catch (error) {
                console.error('å‹•ç”»ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                alert('å‹•ç”»ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ¬¡ã®æ›²ã«é€²ã¿ã¾ã™ã€‚');
                nextQuestion();
                return;
            }
            // ãƒ­ãƒ¼ãƒ‰å¾Œã«åœæ­¢ï¼ˆå†ç”Ÿãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¾ã§å¾…æ©Ÿï¼‰
            // å°‘ã—é•·ã‚ã«å¾…ã£ã¦éŸ³å£°ã‚‚ç¢ºå®Ÿã«ãƒ­ãƒ¼ãƒ‰
            setTimeout(() => {
                ytPlayer.pauseVideo();
                // ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ã‚’ç¢ºèª
                ytPlayer.unMute();
                ytPlayer.setVolume(100);
            }, 800);
        }

        // ã‚¤ãƒ³ãƒˆãƒ­å†ç”Ÿ
        async function playIntro() {
            if (!ytPlayer || !playerReady) {
                alert('YouTube PlayerãŒæº–å‚™ã§ãã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
            if (typeof ytPlayer.playVideo !== 'function') {
                alert('YouTube PlayerãŒæ­£ã—ãåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            if (playbackTimer) {
                clearInterval(playbackTimer);
            }
            
            // ãƒœã‚¿ãƒ³ã‚’ã€Œæº–å‚™ä¸­ã€ã«
            const playBtn = document.getElementById('playButton');
            const pauseBtn = document.getElementById('pauseButton');
            playBtn.textContent = 'æº–å‚™ä¸­...';
            playBtn.disabled = true;
            
            try {
                // ã€é‡è¦ã€‘ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã®ç›´å¾Œã«éŸ³å£°ã‚’æœ‰åŠ¹åŒ–
                ytPlayer.unMute();
                ytPlayer.setVolume(100);
                
                // æ—¢ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹å‹•ç”»ã‚’æœ€åˆã‹ã‚‰å†ç”Ÿ
                ytPlayer.seekTo(0, true);
                
                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†ç”Ÿé–‹å§‹ï¼ˆç¢ºå®Ÿã«éŸ³å£°ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã‚‹ã‚ˆã†ã«ï¼‰
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // å†ç”Ÿé–‹å§‹ï¼ˆã“ã®æ™‚ç‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã®æ–‡è„ˆãŒæ®‹ã£ã¦ã„ã‚‹ï¼‰
                ytPlayer.playVideo();
                
                // ã•ã‚‰ã«å°‘ã—å¾…ã£ã¦ã€éŸ³å£°ãŒç¢ºå®Ÿã«å‡ºã‚‹ã‚ˆã†ã«ã™ã‚‹
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // ã‚‚ã†ä¸€åº¦ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ã‚’ç¢ºèªï¼ˆå¿µã®ãŸã‚ï¼‰
                if (ytPlayer.isMuted()) {
                    ytPlayer.unMute();
                    ytPlayer.setVolume(100);
                }
                
                // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
                isPlaying = true;
                playBtn.textContent = 'â–¶ï¸ å†ç”Ÿ';
                playBtn.disabled = true;
                pauseBtn.disabled = false;
                
                const startTime = Date.now();
                const targetDuration = introTime * 1000;
                const timerDisplay = document.getElementById('timer');
                
                playbackTimer = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const remaining = Math.max(0, Math.ceil((targetDuration - elapsed) / 1000));
                    
                    timerDisplay.textContent = remaining + 'ç§’';
                    
                    if (elapsed >= targetDuration) {
                        clearInterval(playbackTimer);
                        ytPlayer.pauseVideo();
                        timerDisplay.textContent = 'çµ‚äº†';
                        isPlaying = false;
                        playBtn.disabled = false;
                        pauseBtn.disabled = true;
                    }
                }, 100);
                
            } catch (error) {
                console.error('å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);
                playBtn.textContent = 'â–¶ï¸ å†ç”Ÿ';
                playBtn.disabled = false;
            }
        }
        
        // ã‚¤ãƒ³ãƒˆãƒ­ä¸€æ™‚åœæ­¢
        function pauseIntro() {
            if (!ytPlayer) {
                return;
            }
            
            // å†ç”Ÿã‚’åœæ­¢
            ytPlayer.pauseVideo();
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
            if (playbackTimer) {
                clearInterval(playbackTimer);
                playbackTimer = null;
            }
            
            // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æ›´æ–°
            isPlaying = false;
            document.getElementById('playButton').disabled = false;
            document.getElementById('pauseButton').disabled = true;
            document.getElementById('timer').textContent = 'åœæ­¢ä¸­';
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å›ç­”
        function playerAnswer(playerId) {
            if (questionAnswered) {
                alert('ã“ã®å•é¡Œã¯æ—¢ã«å›ç­”ã•ã‚Œã¦ã„ã¾ã™');
                return;
            }
            
            const player = players.find(p => p.id === playerId);
            const correctAnswer = confirm(`${player.name}ã•ã‚“ã®å›ç­”ã¯æ­£è§£ã§ã™ã‹?`);
            
            if (correctAnswer) {
                // ã‚¤ãƒ³ãƒˆãƒ­å†ç”Ÿã‚’åœæ­¢
                if (ytPlayer) {
                    ytPlayer.pauseVideo();
                }
                if (playbackTimer) {
                    clearInterval(playbackTimer);
                    playbackTimer = null;
                }
                document.getElementById('timer').textContent = 'æ­£è§£!';
                
                scores[playerId] = (scores[playerId] || 0) + 10;
                saveScores();
                updateScoreBoard();
                questionAnswered = true;
                
                alert(`ğŸ‰ æ­£è§£! ${player.name}ã•ã‚“ã«10ãƒã‚¤ãƒ³ãƒˆ!`);
            } else {
                alert(`âŒ ä¸æ­£è§£...`);
            }
        }

        // ç­”ãˆã‚’è¡¨ç¤º
        function showAnswer() {
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            if (playbackTimer) {
                clearInterval(playbackTimer);
                playbackTimer = null;
            }
            
            const song = selectedSongs[currentQuestionIndex];
            
            document.getElementById('currentSongTitle').textContent = song.title;
            document.getElementById('currentSongTitle').classList.remove('hidden');
            document.getElementById('timer').textContent = 'ç­”ãˆè¡¨ç¤ºä¸­';
            
            // å…¨æ›²å†ç”Ÿ
            if (ytPlayer) {
                // ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ã‚’ç¢ºèª
                if (ytPlayer.isMuted()) {
                    ytPlayer.unMute();
                }
                ytPlayer.setVolume(100);
                
                ytPlayer.seekTo(0, true);
                setTimeout(() => {
                    ytPlayer.playVideo();
                }, 300);
            }
        }

        // æ¬¡ã®å•é¡Œ
        function nextQuestion() {
            // å†ç”Ÿã‚’åœæ­¢
            if (ytPlayer) {
                ytPlayer.pauseVideo();
                ytPlayer.stopVideo();
            }
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            if (playbackTimer) {
                clearInterval(playbackTimer);
                playbackTimer = null;
            }
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= selectedSongs.length) {
                endQuiz();
            } else {
                loadQuestion();
            }
        }

        // ã‚¯ã‚¤ã‚ºçµ‚äº†
        function endQuiz() {
            // å†ç”Ÿã‚’å®Œå…¨åœæ­¢
            if (ytPlayer) {
                ytPlayer.pauseVideo();
                ytPlayer.stopVideo();
            }
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            if (playbackTimer) {
                clearInterval(playbackTimer);
                playbackTimer = null;
            }
            
            document.getElementById('quizGame').classList.add('hidden');
            document.getElementById('userManagement').classList.remove('hidden');
            
            // æœ€çµ‚çµæœè¡¨ç¤º
            const sortedPlayers = [...players].sort((a, b) => (scores[b.id] || 0) - (scores[a.id] || 0));
            const winner = sortedPlayers[0];
            
            if (winner && scores[winner.id] > 0) {
                alert(`ğŸ† å„ªå‹: ${winner.name}ã•ã‚“ (${scores[winner.id]}ãƒã‚¤ãƒ³ãƒˆ)`);
            }
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function savePlayers() {
            localStorage.setItem('quizPlayers', JSON.stringify(players));
        }

        function saveScores() {
            localStorage.setItem('quizScores', JSON.stringify(scores));
        }
        
        function saveSelectedSongs() {
            localStorage.setItem('selectedSongs', JSON.stringify(selectedSongs));
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>
