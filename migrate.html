<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        .log-area {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 16px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-success { color: #4ade80; }
        .log-error { color: #f87171; }
        .log-info { color: #60a5fa; }
        .log-warning { color: #fbbf24; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen p-8">

    <div class="container mx-auto max-w-4xl">
        <div class="bg-white rounded-xl shadow-2xl p-8">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ”„</div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ„ãƒ¼ãƒ«</h1>
                <p class="text-gray-600">æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚·ã‚¹ãƒ†ãƒ ã«ç§»è¡Œã—ã¾ã™</p>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—1: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ç¢ºèª -->
            <div class="mb-8 p-6 bg-blue-50 rounded-lg">
                <h2 class="text-xl font-bold mb-4 text-blue-800">ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—1: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª</h2>
                <button onclick="checkExistingData()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold transition">
                    æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹
                </button>
                <div id="existingDataInfo" class="mt-4 text-sm"></div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ç§»è¡Œå…ˆã‚°ãƒ«ãƒ¼ãƒ—IDæŒ‡å®š -->
            <div class="mb-8 p-6 bg-green-50 rounded-lg">
                <h2 class="text-xl font-bold mb-4 text-green-800">ğŸ¯ ã‚¹ãƒ†ãƒƒãƒ—2: ç§»è¡Œå…ˆã‚°ãƒ«ãƒ¼ãƒ—ã®æŒ‡å®š</h2>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-700">ç§»è¡Œå…ˆã‚°ãƒ«ãƒ¼ãƒ—ID</label>
                    <input type="text" id="targetGroupId" 
                           class="w-full px-4 py-2 border rounded-lg focus:border-green-500 focus:outline-none"
                           placeholder="ä¾‹: main, legacy, 2024-history"
                           pattern="[a-zA-Z0-9-]+"
                           value="main">
                    <p class="text-xs text-gray-500 mt-1">â€» è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨å¯èƒ½</p>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2 text-gray-700">ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆè¡¨ç¤ºç”¨ï¼‰</label>
                    <input type="text" id="targetGroupName" 
                           class="w-full px-4 py-2 border rounded-lg focus:border-green-500 focus:outline-none"
                           placeholder="ä¾‹: ãƒ¡ã‚¤ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—, éå»ãƒ‡ãƒ¼ã‚¿"
                           value="ãƒ¡ã‚¤ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—">
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ç§»è¡Œå®Ÿè¡Œ -->
            <div class="mb-8 p-6 bg-purple-50 rounded-lg">
                <h2 class="text-xl font-bold mb-4 text-purple-800">ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—3: ç§»è¡Œã®å®Ÿè¡Œ</h2>
                <div class="mb-4 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700">
                    <p class="font-bold">âš ï¸ æ³¨æ„äº‹é …</p>
                    <ul class="list-disc list-inside text-sm mt-2">
                        <li>ã“ã®æ“ä½œã¯æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ï¼ˆå…ƒãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ï¼‰</li>
                        <li>ç§»è¡Œå¾Œã€å…ƒãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹ã‹ã¯ã”è‡ªèº«ã§åˆ¤æ–­ã—ã¦ãã ã•ã„</li>
                        <li>ç§»è¡Œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚ç¢ºèªã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„</li>
                    </ul>
                </div>
                <button onclick="migrateData()" 
                        class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-bold transition">
                    ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œã™ã‚‹
                </button>
            </div>

            <!-- ãƒ­ã‚°è¡¨ç¤º -->
            <div class="mb-4">
                <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h2>
                <div id="logArea" class="log-area"></div>
            </div>

            <!-- ç§»è¡Œå¾Œã®æ“ä½œ -->
            <div id="afterMigration" style="display: none;" class="p-6 bg-green-100 border-l-4 border-green-500 rounded">
                <h3 class="font-bold text-green-800 mb-2">âœ… ç§»è¡Œå®Œäº†å¾Œã®æ“ä½œ</h3>
                <ol class="list-decimal list-inside text-sm text-green-700 space-y-1">
                    <li>admin.htmlã§ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
                    <li>ç§»è¡Œã—ãŸã‚°ãƒ«ãƒ¼ãƒ—ã®URLã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
                    <li>ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«ç§»è¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã§ãã¾ã™</li>
                </ol>
                <div class="mt-4">
                    <button onclick="deleteOldData()" 
                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm">
                        å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹ï¼ˆä»»æ„ï¼‰
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyA7bkfPDgs3iSNFC2MOxjs1aakbHbMi-jM",
            authDomain: "mahjong-337a9.firebaseapp.com",
            databaseURL: "https://mahjong-337a9-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mahjong-337a9",
            storageBucket: "mahjong-337a9.firebasestorage.app",
            messagingSenderId: "605742422445",
            appId: "1:605742422445:web:e207ae05cba0a67f7b2924",
            measurementId: "G-2VDY4LKSPP"
        };

        // FirebaseåˆæœŸåŒ–
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let existingData = null;

        // ãƒ­ã‚°å‡ºåŠ›
        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const className = `log-${type}`;
            logArea.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`[${type}] ${message}`);
        }

        // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
        async function checkExistingData() {
            log('æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            try {
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆ/passwords ã¾ãŸã¯ /settings/passwords ã‚’ç¢ºèªï¼‰
                let passwordsSnapshot = await database.ref('passwords').once('value');
                let passwords = passwordsSnapshot.val();
                
                // /passwords ã«ãªã„å ´åˆã¯ /settings/passwords ã‚’ç¢ºèª
                if (!passwords) {
                    passwordsSnapshot = await database.ref('settings/passwords').once('value');
                    passwords = passwordsSnapshot.val();
                    console.log('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆ/settings/passwordsï¼‰:', passwords);
                } else {
                    console.log('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆ/passwordsï¼‰:', passwords);
                }
                
                // éº»é›€ãƒ‡ãƒ¼ã‚¿ï¼ˆæ­£ã—ã„ãƒ‘ã‚¹ã¯ /mahjongï¼‰
                const mahjongSnapshot = await database.ref('mahjong').once('value');
                const mahjongData = mahjongSnapshot.val();
                console.log('éº»é›€ãƒ‡ãƒ¼ã‚¿:', mahjongData);
                console.log('éº»é›€ãƒ‡ãƒ¼ã‚¿æ§‹é€ :', {
                    hasData: !!mahjongData,
                    hasDataProperty: mahjongData?.data ? true : false,
                    hasDates: mahjongData?.data?.dates ? true : false,
                    hasAllPlayers: mahjongData?.allPlayers ? true : false,
                    dateCount: mahjongData?.data?.dates ? Object.keys(mahjongData.data.dates).length : 0,
                    playerCount: mahjongData?.allPlayers ? mahjongData.allPlayers.length : 0
                });
                
                // ãƒªãƒ¼ã‚°ãƒ‡ãƒ¼ã‚¿
                const leaguesSnapshot = await database.ref('leagues').once('value');
                const leagues = leaguesSnapshot.val();
                console.log('ãƒªãƒ¼ã‚°ãƒ‡ãƒ¼ã‚¿:', leagues);

                existingData = {
                    passwords: passwords,
                    mahjongData: mahjongData,
                    leagues: leagues
                };

                // ãƒ‡ãƒ¼ã‚¿ã®çµ±è¨ˆã‚’è¡¨ç¤º
                let infoHtml = '<div class="mt-4 p-4 bg-white rounded border">';
                infoHtml += '<h3 class="font-bold mb-2">æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®å†…å®¹:</h3>';
                infoHtml += '<ul class="text-sm space-y-1">';
                
                if (passwords) {
                    infoHtml += `<li>âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š: ã‚ã‚Š</li>`;
                } else {
                    infoHtml += `<li>âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š: ãªã—</li>`;
                }
                
                if (mahjongData) {
                    const dates = mahjongData.data?.dates || {};
                    const dateCount = Object.keys(dates).length;
                    const players = mahjongData.allPlayers || [];
                    infoHtml += `<li>âœ… å¯¾å±€ãƒ‡ãƒ¼ã‚¿: ${dateCount}æ—¥åˆ†</li>`;
                    infoHtml += `<li>âœ… ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: ${players.length}äºº</li>`;
                    
                    // ã‚²ãƒ¼ãƒ ç·æ•°ã‚’è¨ˆç®—
                    let totalGames = 0;
                    Object.values(dates).forEach(dateData => {
                        if (dateData.games) {
                            totalGames += dateData.games.length;
                        }
                    });
                    infoHtml += `<li>âœ… ç·ã‚²ãƒ¼ãƒ æ•°: ${totalGames}å±€</li>`;
                } else {
                    infoHtml += `<li>âŒ å¯¾å±€ãƒ‡ãƒ¼ã‚¿: ãªã—</li>`;
                }
                
                if (leagues) {
                    const leagueCount = Object.keys(leagues).length;
                    infoHtml += `<li>âœ… ãƒªãƒ¼ã‚°æˆ¦: ${leagueCount}ä»¶</li>`;
                } else {
                    infoHtml += `<li>âŒ ãƒªãƒ¼ã‚°æˆ¦: ãªã—</li>`;
                }
                
                infoHtml += '</ul></div>';
                
                document.getElementById('existingDataInfo').innerHTML = infoHtml;
                
                log('æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                log(`å¯¾å±€ãƒ‡ãƒ¼ã‚¿: ${mahjongData ? 'æœ‰' : 'ç„¡'}`, 'info');
                log(`ãƒªãƒ¼ã‚°ãƒ‡ãƒ¼ã‚¿: ${leagues ? Object.keys(leagues).length + 'ä»¶' : 'ç„¡'}`, 'info');

                if (!passwords && !mahjongData && !leagues) {
                    log('ç§»è¡Œã™ã‚‹æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'warning');
                }

            } catch (error) {
                log('ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                console.error(error);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã®å®Ÿè¡Œ
        async function migrateData() {
            const targetGroupId = document.getElementById('targetGroupId').value.trim();
            const targetGroupName = document.getElementById('targetGroupName').value.trim();

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!targetGroupId) {
                alert('ç§»è¡Œå…ˆã‚°ãƒ«ãƒ¼ãƒ—IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            if (!/^[a-zA-Z0-9-]+$/.test(targetGroupId)) {
                alert('ã‚°ãƒ«ãƒ¼ãƒ—IDã«ã¯è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨ã§ãã¾ã™');
                return;
            }
            if (!targetGroupName) {
                alert('ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
            if (!existingData) {
                log('å…ˆã«ã€Œæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹ã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
                alert('å…ˆã«ã‚¹ãƒ†ãƒƒãƒ—1ã§æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                return;
            }

            // æœ€çµ‚ç¢ºèª
            if (!confirm(`ä»¥ä¸‹ã®å†…å®¹ã§ç§»è¡Œã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n\nç§»è¡Œå…ˆã‚°ãƒ«ãƒ¼ãƒ—ID: ${targetGroupId}\nã‚°ãƒ«ãƒ¼ãƒ—å: ${targetGroupName}`)) {
                log('ç§»è¡ŒãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ', 'info');
                return;
            }

            log('==================================', 'info');
            log('ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            log(`ç§»è¡Œå…ˆ: groups/${targetGroupId}/`, 'info');
            log('==================================', 'info');

            try {
                // ã‚°ãƒ«ãƒ¼ãƒ—ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                const groupSnapshot = await database.ref(`groups/${targetGroupId}`).once('value');
                if (groupSnapshot.exists()) {
                    if (!confirm('ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—IDã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
                        log('ç§»è¡ŒãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ', 'warning');
                        return;
                    }
                    log('æ—¢å­˜ã‚°ãƒ«ãƒ¼ãƒ—ã«ä¸Šæ›¸ãã—ã¾ã™', 'warning');
                }

                // 1. ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã®ä½œæˆ
                log('ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã‚’ä½œæˆä¸­...', 'info');
                await database.ref(`groups/${targetGroupId}/info`).set({
                    groupId: targetGroupId,
                    name: targetGroupName,
                    description: 'æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç§»è¡Œ',
                    createdAt: new Date().toISOString(),
                    migratedAt: new Date().toISOString(),
                    migratedFrom: 'legacy'
                });
                log('âœ“ ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã‚’ä½œæˆã—ã¾ã—ãŸ', 'success');

                // 2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç§»è¡Œ
                if (existingData.passwords) {
                    log('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç§»è¡Œä¸­...', 'info');
                    await database.ref(`groups/${targetGroupId}/passwords`).set(existingData.passwords);
                    log('âœ“ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç§»è¡Œã—ã¾ã—ãŸ', 'success');
                } else {
                    log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šä¸­...', 'info');
                    await database.ref(`groups/${targetGroupId}/passwords`).set({
                        login: 'mahjong2024',
                        delete: 'mahjong1234'
                    });
                    log('âœ“ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã—ãŸ', 'success');
                }

                // 3. éº»é›€ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œ
                if (existingData.mahjongData) {
                    log('å¯¾å±€ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œä¸­...', 'info');
                    console.log('ç§»è¡Œã™ã‚‹éº»é›€ãƒ‡ãƒ¼ã‚¿:', existingData.mahjongData);
                    
                    await database.ref(`groups/${targetGroupId}/mahjong`).set(existingData.mahjongData);
                    log('âœ“ å¯¾å±€ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œã—ã¾ã—ãŸ', 'success');
                    
                    const dates = existingData.mahjongData.data?.dates || {};
                    log(`  - ${Object.keys(dates).length}æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿`, 'info');
                    log(`  - ${existingData.mahjongData.allPlayers?.length || 0}äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼`, 'info');
                    
                    // ç§»è¡Œå¾Œã®ç¢ºèª
                    const verifySnapshot = await database.ref(`groups/${targetGroupId}/mahjong`).once('value');
                    const verifiedData = verifySnapshot.val();
                    console.log('ç§»è¡Œå¾Œã®ç¢ºèª:', verifiedData);
                    log('âœ“ ç§»è¡Œãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã—ãŸ', 'success');
                } else {
                    log('âš ï¸ éº»é›€ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'warning');
                    console.log('existingData.mahjongData is:', existingData.mahjongData);
                }

                // 4. ãƒªãƒ¼ã‚°ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œ
                if (existingData.leagues) {
                    log('ãƒªãƒ¼ã‚°æˆ¦ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œä¸­...', 'info');
                    await database.ref(`groups/${targetGroupId}/leagues`).set(existingData.leagues);
                    log('âœ“ ãƒªãƒ¼ã‚°æˆ¦ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œã—ã¾ã—ãŸ', 'success');
                    log(`  - ${Object.keys(existingData.leagues).length}ä»¶ã®ãƒªãƒ¼ã‚°`, 'info');
                }

                log('==================================', 'success');
                log('âœ… ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');
                log('==================================', 'success');
                log(`ã‚¢ã‚¯ã‚»ã‚¹URL: mobile-firebase.html?group=${targetGroupId}`, 'info');

                // ç§»è¡Œå¾Œã®æ“ä½œã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                document.getElementById('afterMigration').style.display = 'block';

                alert('ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nadmin.htmlã§ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');

            } catch (error) {
                log('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'error');
                console.error(error);
                alert('ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
        async function deleteOldData() {
            if (!confirm('âš ï¸ è­¦å‘Š\n\nå…ƒã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ/mahjong, /leagues, /passwords, /settingsï¼‰ã‚’å‰Šé™¤ã—ã¾ã™ã€‚\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã§ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã‹ï¼Ÿ')) {
                return;
            }

            if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿï¼ˆæœ€çµ‚ç¢ºèªï¼‰')) {
                return;
            }

            log('==================================', 'warning');
            log('å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ä¸­...', 'warning');

            try {
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å‰Šé™¤
                const passwordsExists = await database.ref('passwords').once('value');
                if (passwordsExists.val()) {
                    await database.ref('passwords').remove();
                    log('âœ“ /passwords ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                }

                // settingså‰Šé™¤
                const settingsExists = await database.ref('settings').once('value');
                if (settingsExists.val()) {
                    await database.ref('settings').remove();
                    log('âœ“ /settings ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                }

                // éº»é›€ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆæ­£ã—ã„ãƒ‘ã‚¹ã¯ /mahjongï¼‰
                await database.ref('mahjong').remove();
                log('âœ“ /mahjong ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');

                await database.ref('leagues').remove();
                log('âœ“ /leagues ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');

                log('==================================', 'success');
                log('âœ… å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                log('ã“ã‚Œã§å®Œå…¨ã«æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚·ã‚¹ãƒ†ãƒ ã«ç§»è¡Œã•ã‚Œã¾ã—ãŸ', 'success');

                alert('å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚\n\nä»Šå¾Œã¯æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚·ã‚¹ãƒ†ãƒ ã®ã¿ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');

            } catch (error) {
                log('âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                console.error(error);
                alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
        window.onload = function() {
            log('ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ„ãƒ¼ãƒ«ã‚’èµ·å‹•ã—ã¾ã—ãŸ', 'success');
            log('ã‚¹ãƒ†ãƒƒãƒ—1ã‹ã‚‰é †ç•ªã«å®Ÿè¡Œã—ã¦ãã ã•ã„', 'info');
        };
    </script>
</body>
</html>
